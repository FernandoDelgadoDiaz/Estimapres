<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
    <title>EstimaF ¬∑ Premium Fintech</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #2563eb; --accent: #10b981; --bg: #f8fafc; 
            --white: #ffffff; --text: #0f172a; --dim: #64748b;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%); 
            color: var(--text); min-height: 100vh; overflow-x: hidden;
        }
        
        /* Navbar */
        .nav { padding: 25px 5%; display: flex; justify-content: space-between; align-items: center; }
        .logo { color: white; font-weight: 800; font-size: 26px; letter-spacing: -1px; }
        .logo span { background: white; color: var(--primary); padding: 2px 10px; border-radius: 10px; margin-right: 5px; }
        
        .main { max-width: 1100px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 40px; }
        @media (max-width: 900px) { .main { grid-template-columns: 1fr; } }

        /* Typography */
        .hero-h1 { color: white; font-size: 56px; font-weight: 800; line-height: 1.1; margin: 0; }
        .hero-p { color: rgba(255,255,255,0.8); font-size: 18px; margin: 20px 0 40px; }

        /* Cards */
        .glass { 
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px);
            border-radius: 35px; padding: 35px; border: 1px solid rgba(255,255,255,0.4);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        /* Inputs & Buttons */
        .input-box { margin-bottom: 20px; }
        label { display: block; font-size: 13px; font-weight: 700; color: var(--dim); margin-bottom: 8px; text-transform: uppercase; }
        input { 
            width: 100%; padding: 18px; border-radius: 16px; border: 1px solid #e2e8f0;
            background: #f1f5f9; font-size: 16px; font-weight: 700; color: var(--text);
        }
        .btn { 
            width: 100%; padding: 20px; border-radius: 18px; border: none; 
            font-weight: 800; font-size: 16px; cursor: pointer; transition: 0.3s;
        }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 10px 20px rgba(37,99,235,0.2); }
        .btn-send { background: linear-gradient(90deg, #10b981, #059669); color: white; margin-top: 15px; }
        
        /* Elements */
        .status-tag { padding: 6px 14px; border-radius: 50px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .item-row { 
            background: white; border-radius: 20px; padding: 20px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid #f1f5f9;
        }
        
        .floating-exit { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 2000; }
        .exit-pill { background: white; color: black; padding: 15px 35px; border-radius: 50px; font-weight: 800; border: none; box-shadow: 0 15px 30px rgba(0,0,0,0.3); cursor: pointer; }

        #admin-view, #client-dashboard, #form-solicitud, .hidden { display: none; }
    </style>
</head>
<body>

<nav class="nav">
    <div class="logo"><span>F</span> EstimaF</div>
    <button id="authAdmin" style="background:rgba(255,255,255,0.15); border:none; color:white; padding:10px 20px; border-radius:12px; font-weight:700; cursor:pointer;">Acceso Admin</button>
</nav>

<div id="exitBar" class="hidden floating-exit">
    <button onclick="cerrarSesion()" class="exit-pill">SALIR / MODO CLIENTE ‚Üê</button>
</div>

<main class="main">
    <div id="hero-side">
        <h1 class="hero-h1">Prestar</h1>
        <p class="hero-p">Gesti√≥n inteligente de cr√©ditos personales con aprobaci√≥n en 24hs.</p>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="glass" style="padding:20px; text-align:center;">
                <div style="font-size:24px; font-weight:800; color:var(--primary);">+500</div>
                <div style="font-size:12px; font-weight:700; color:var(--dim);">CR√âDITOS</div>
            </div>
            <div class="glass" style="padding:20px; text-align:center;">
                <div style="font-size:24px; font-weight:800; color:var(--accent);">100%</div>
                <div style="font-size:12px; font-weight:700; color:var(--dim);">SEGURO</div>
            </div>
        </div>
    </div>

    <div id="user-view" class="glass">
        <h2 style="margin-top:0; font-size:24px;">Simulador</h2>
        <div class="input-box">
            <label>Monto del Pr√©stamo</label>
            <input id="amt" type="number" placeholder="$ 500.000">
        </div>
        <div class="input-box">
            <label>Plazo en Meses</label>
            <input id="mos" type="number" placeholder="Ej: 12">
        </div>
        <button id="calc" class="btn btn-primary">CALCULAR CUOTA</button>

        <div id="form-solicitud" style="margin-top:30px; border-top:2px solid #f1f5f9; padding-top:25px;">
            <input id="cName" placeholder="Nombre completo" style="margin-bottom:12px;">
            <input id="cDni" placeholder="DNI sin puntos" style="margin-bottom:12px;">
            <input id="cEmail" placeholder="correo@ejemplo.com" style="margin-bottom:15px;">
            <button id="sendSol" class="btn btn-send">SOLICITAR CR√âDITO</button>
        </div>
        <button onclick="verEstadoDni()" style="width:100%; background:none; border:none; color:var(--primary); margin-top:20px; font-weight:700; cursor:pointer; text-decoration:underline;">Ya soy cliente, ver mi pr√©stamo</button>
    </div>

    <div id="client-dashboard" class="glass" style="grid-column: 1 / -1;">
        <h2 id="clientWelcome" style="font-size:32px; margin-bottom:5px;">Hola, Bienvenido</h2>
        <p style="color:var(--dim); margin-bottom:30px;">Aqu√≠ tienes el detalle de tu plan de pagos.</p>
        <div id="cuotasContainer"></div>
    </div>

    <div id="admin-view" class="glass" style="grid-column: 1 / -1;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <h2 style="margin:0;">Panel de Control</h2>
            <div style="display:flex; align-items:center; gap:10px; background:#f1f5f9; padding:10px; border-radius:15px;">
                <label style="margin:0;">Inter√©s (%):</label>
                <input id="sysTasa" type="number" style="width:70px; padding:8px; background:white;">
                <button id="saveTasa" class="btn-primary" style="padding:8px 15px; border-radius:8px; border:none; cursor:pointer;">OK</button>
            </div>
        </div>
        <div id="adminLoans"></div>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, serverTimestamp, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBuLQHhsOBTr2e8Kp5HKUz-a7xXgrgLlUI",
      authDomain: "estimapres.firebaseapp.com",
      projectId: "estimapres",
      storageBucket: "estimapres.firebasestorage.app",
      messagingSenderId: "578516597437",
      appId: "1:578516597437:web:f59994b87729aa1cd655d4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const $ = id => document.getElementById(id);

    let tVal = 100;

    // Load Config
    async function getT() {
        const d = await getDoc(doc(db, "config", "interes"));
        if(d.exists()) { tVal = d.data().valor; $("sysTasa").value = tVal; }
    }
    getT();

    $("saveTasa").onclick = async () => {
        await setDoc(doc(db, "config", "interes"), { valor: Number($("sysTasa").value) });
        tVal = Number($("sysTasa").value);
        alert("Configuraci√≥n actualizada.");
    };

    window.cerrarSesion = () => signOut(auth).then(() => location.reload());

    // Flow
    $("calc").onclick = () => { if($("amt").value && $("mos").value) $("form-solicitud").style.display = "block"; };

    $("sendSol").onclick = async () => {
        const m = Number($("amt").value); const p = Number($("mos").value);
        const vc = Math.round((m * (1 + (tVal/100))) / p);
        const plan = Array.from({length: p}, (_, i) => ({ n: i+1, v: vc, s: "pendiente" }));
        
        await addDoc(collection(db, "loans"), {
            name: $("cName").value, dni: $("cDni").value, amount: m,
            plan: plan, status: "preaprobado", date: serverTimestamp()
        });
        alert("Solicitud recibida. Nos contactaremos pronto."); location.reload();
    };

    window.verEstadoDni = async () => {
        const d = prompt("Ingrese su DNI:");
        if(!d) return;
        const q = query(collection(db, "loans"), where("dni", "==", d));
        const s = await getDocs(q);
        if(s.empty) return alert("No registrado.");

        $("user-view").style.display = "none";
        $("hero-side").style.display = "none";
        $("exitBar").classList.remove("hidden");
        $("client-dashboard").style.display = "block";

        s.forEach(snap => {
            const l = snap.data();
            $("clientWelcome").innerText = `Hola, ${l.name.split(' ')[0]}`;
            let h = "";
            l.plan.forEach(c => h += `
                <div class="item-row">
                    <div><b>Cuota ${c.n}</b><br><small style="color:var(--dim)">$${c.v.toLocaleString()}</small></div>
                    <span class="status-tag" style="background:${c.s==='pagado'?'#d1fae5':'#f1f5f9'}; color:${c.s==='pagado'?'#065f46':'#64748b'}">${c.s}</span>
                </div>`);
            $("cuotasContainer").innerHTML = h;
        });
    };

    // Admin Panel
    async function loadAdmin() {
        const s = await getDocs(collection(db, "loans"));
        $("adminLoans").innerHTML = "";
        s.forEach(snap => {
            const l = snap.data();
            let cList = l.plan.map((c, i) => `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid #f1f5f9;">
                    <span>C${c.n} ($${c.v})</span>
                    <button onclick="window.payC('${snap.id}', ${i})" style="padding:5px 10px; border:none; border-radius:8px; cursor:pointer; background:${c.s==='pagado'?'#10b981':'#2563eb'}; color:white;">${c.s==='pagado'?'LISTO':'PAGAR'}</button>
                </div>`).join('');

            $("adminLoans").innerHTML += `
                <div class="glass" style="margin-bottom:20px; border-radius:24px;">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <h3 style="margin:0;">${l.name}</h3>
                            <small style="color:var(--dim)">DNI: ${l.dni} | Total: $${l.amount}</small>
                        </div>
                        <button onclick="window.delL('${snap.id}')" style="background:#fee2e2; border:none; padding:10px; border-radius:12px; cursor:pointer;">üóëÔ∏è</button>
                    </div>
                    <div style="margin-top:15px; max-height:150px; overflow-y:auto;">${cList}</div>
                </div>`;
        });
    }

    window.payC = async (id, i) => {
        const dr = doc(db, "loans", id); const d = await getDoc(dr);
        let p = d.data().plan; p[i].s = "pagado";
        await updateDoc(dr, { plan: p });
        loadAdmin();
    };
    window.delL = async (id) => { if(confirm("¬øBorrar?")) { await deleteDoc(doc(db, "loans", id)); loadAdmin(); } };

    $("authAdmin").onclick = () => {
        const m = prompt("Email:"); const p = prompt("Password:");
        if(m && p) signInWithEmailAndPassword(auth, m, p).catch(() => alert("Error de acceso"));
    };

    onAuthStateChanged(auth, u => {
        if(u && u.email === "fernandogastondelgado81@gmail.com") {
            $("user-view").style.display = "none";
            $("hero-side").style.display = "none";
            $("exitBar").classList.remove("hidden");
            $("admin-view").style.display = "block";
            loadAdmin();
        }
    });
</script>
</body>
</html>
