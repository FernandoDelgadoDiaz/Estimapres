<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
    <title>EstimaF ¬∑ Sistema Profesional</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --main-blue: #1e40af; --accent-green: #10b981;
            --white: #ffffff; --text-dark: #0f172a; --text-muted: #64748b;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); 
            background-attachment: fixed; color: var(--text-dark); min-height: 100vh;
        }

        /* Navbar estilo Imagen 5 */
        .header { padding: 25px 6%; display: flex; justify-content: space-between; align-items: center; }
        .logo { color: white; font-weight: 800; font-size: 26px; display: flex; align-items: center; gap: 10px; }
        .logo span { background: white; color: var(--main-blue); padding: 5px 12px; border-radius: 12px; }
        .admin-btn { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 12px 20px; border-radius: 14px; font-weight: 700; cursor: pointer; transition: 0.3s; }

        .container { max-width: 1100px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 1fr 1.1fr; gap: 50px; align-items: start; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }

        /* Card Estilo "Ideal" */
        .glass-card {
            background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(25px);
            border-radius: 40px; padding: 40px; border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 40px 80px rgba(0,0,0,0.2);
        }

        h1 { color: white; font-size: 64px; font-weight: 800; margin: 0; letter-spacing: -2px; line-height: 1; }
        .hero-sub { color: rgba(255,255,255,0.85); font-size: 18px; margin: 20px 0 40px; font-weight: 600; }

        /* Inputs Premium */
        .field { margin-bottom: 25px; }
        label { display: block; font-size: 14px; font-weight: 800; color: var(--text-muted); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        input { 
            width: 100%; padding: 20px; border-radius: 18px; border: 1px solid #e2e8f0;
            background: #f8fafc; font-size: 16px; font-weight: 700; color: var(--text-dark); transition: 0.3s;
        }
        input:focus { outline: none; border-color: var(--main-blue); background: white; box-shadow: 0 0 0 5px rgba(37,99,235,0.1); }

        .btn-main { 
            width: 100%; padding: 22px; border-radius: 20px; border: none; 
            background: var(--main-blue); color: white; font-weight: 800; font-size: 16px; 
            cursor: pointer; box-shadow: 0 15px 30px rgba(30, 64, 175, 0.25); transition: 0.3s;
        }
        .btn-main:active { transform: scale(0.98); }

        /* Listas y Admin */
        .loan-card { background: white; border-radius: 28px; padding: 25px; margin-bottom: 20px; border: 1px solid #f1f5f9; }
        .cuota-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f1f5f9; }
        .cuota-item:last-child { border: none; }
        .pay-pill { background: var(--main-blue); color: white; border: none; padding: 8px 16px; border-radius: 12px; font-weight: 700; cursor: pointer; }
        .pay-pill.done { background: #d1fae5; color: #065f46; cursor: default; }

        .floating-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; }
        .exit-pill { background: white; color: black; padding: 16px 45px; border-radius: 100px; font-weight: 800; border: none; box-shadow: 0 20px 40px rgba(0,0,0,0.3); cursor: pointer; }

        #admin-panel, #client-dashboard, #solicitud-extra, .hidden { display: none; }
    </style>
</head>
<body>

<nav class="header">
    <div class="logo"><span>F</span> EstimaF</div>
    <button id="adminLogin" class="admin-btn">Admin Access</button>
</nav>

<div id="exitContainer" class="hidden floating-bar">
    <button onclick="realLogout()" class="exit-pill">SALIR / MODO CLIENTE ‚Üê</button>
</div>

<main class="container">
    <div id="hero">
        <h1>Prestar</h1>
        <p class="hero-sub">Tecnolog√≠a financiera para pr√©stamos personales de aprobaci√≥n r√°pida.</p>
        <div style="display:flex; gap:15px; margin-top:20px;">
            <div style="background:rgba(255,255,255,0.1); padding:15px 25px; border-radius:20px; color:white; font-weight:700; border:1px solid rgba(255,255,255,0.1);">‚úì SSL Seguro</div>
            <div style="background:rgba(255,255,255,0.1); padding:15px 25px; border-radius:20px; color:white; font-weight:700; border:1px solid rgba(255,255,255,0.1);">‚úì Firebase DB</div>
        </div>
    </div>

    <div id="user-ui" class="glass-card">
        <h2 style="margin-top:0; font-size:28px; margin-bottom:30px;">Simulador</h2>
        <div class="field">
            <label>Monto a solicitar</label>
            <input id="amt" type="number" placeholder="$ 0.00">
        </div>
        <div class="field">
            <label>Plazo (Meses)</label>
            <input id="mos" type="number" placeholder="Ej: 12">
        </div>
        <button id="btnCalc" class="btn-main">CALCULAR CUOTA</button>

        <div id="solicitud-extra" style="margin-top:35px; padding-top:30px; border-top:2px solid #f1f5f9;">
            <div class="field"><label>Nombre Completo</label><input id="cName" placeholder="Juan P√©rez"></div>
            <div class="field"><label>DNI</label><input id="cDni" placeholder="Sin puntos ni espacios"></div>
            <div class="field"><label>Email</label><input id="cEmail" placeholder="ejemplo@correo.com"></div>
            <button id="btnSubmit" class="btn-main" style="background:var(--accent-green); box-shadow: 0 15px 30px rgba(16,185,129,0.2);">SOLICITAR PR√âSTAMO</button>
        </div>
        <button onclick="verDni()" style="width:100%; background:none; border:none; color:var(--main-blue); margin-top:25px; font-weight:800; cursor:pointer; text-decoration:underline; font-size:14px;">CONSULTAR MI ESTADO (DNI)</button>
    </div>

    <div id="admin-panel" class="glass-card" style="grid-column: 1 / -1;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px;">
            <h2 style="margin:0;">Gesti√≥n de Cr√©ditos</h2>
            <div style="display:flex; align-items:center; gap:12px; background:#f8fafc; padding:10px 20px; border-radius:20px; border:1px solid #e2e8f0;">
                <label style="margin:0; font-size:12px;">INTER√âS (%):</label>
                <input id="sysTasa" type="number" style="width:80px; padding:8px; background:white;">
                <button id="saveT" style="padding:10px 20px; border-radius:12px; background:var(--main-blue); color:white; border:none; font-weight:800; cursor:pointer;">OK</button>
            </div>
        </div>
        <div id="adminData"></div>
    </div>

    <div id="client-dashboard" class="glass-card" style="grid-column: 1 / -1;">
        <h2 id="cliTitle" style="font-size:32px; margin-bottom:10px;">Tu Pr√©stamo</h2>
        <p id="cliDni" style="color:var(--text-muted); margin-bottom:40px; font-weight:700;"></p>
        <div id="cliCuotas"></div>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, serverTimestamp, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBuLQHhsOBTr2e8Kp5HKUz-a7xXgrgLlUI",
      authDomain: "estimapres.firebaseapp.com",
      projectId: "estimapres",
      storageBucket: "estimapres.firebasestorage.app",
      messagingSenderId: "578516597437",
      appId: "1:578516597437:web:f59994b87729aa1cd655d4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const $ = id => document.getElementById(id);

    let tGlobal = 100;

    async function initSys() {
        const d = await getDoc(doc(db, "config", "interes"));
        if(d.exists()) { tGlobal = d.data().valor; $("sysTasa").value = tGlobal; }
    }
    initSys();

    $("saveT").onclick = async () => {
        await setDoc(doc(db, "config", "interes"), { valor: Number($("sysTasa").value) });
        tGlobal = Number($("sysTasa").value);
        alert("Configuraci√≥n Guardada");
    };

    window.realLogout = () => signOut(auth).then(() => { window.location.href = window.location.pathname; });

    $("btnCalc").onclick = () => { if($("amt").value && $("mos").value) $("solicitud-extra").style.display = "block"; };

    $("btnSubmit").onclick = async () => {
        const m = Number($("amt").value); const p = Number($("mos").value);
        const vc = Math.round((m * (1 + (tGlobal/100))) / p);
        const plan = Array.from({length: p}, (_, i) => ({ n: i+1, v: vc, s: "pendiente" }));
        
        await addDoc(collection(db, "loans"), {
            name: $("cName").value || "Cliente", 
            dni: $("cDni").value || "0", 
            amount: m,
            plan: plan, 
            status: "preaprobado", 
            date: serverTimestamp()
        });
        alert("Solicitud Enviada con √âxito"); location.reload();
    };

    window.verDni = async () => {
        const d = prompt("Ingrese su DNI:");
        if(!d) return;
        const q = query(collection(db, "loans"), where("dni", "==", d));
        const s = await getDocs(q);
        if(s.empty) return alert("DNI No encontrado");

        $("user-ui").style.display = "none";
        $("hero").style.display = "none";
        $("exitContainer").classList.remove("hidden");
        $("client-dashboard").style.display = "block";

        s.forEach(snap => {
            const data = snap.data();
            $("cliTitle").innerText = `Cr√©dito de ${data.name}`;
            $("cliDni").innerText = `DNI: ${data.dni} | Monto Base: $${data.amount.toLocaleString()}`;
            let h = "";
            data.plan.forEach(c => h += `
                <div class="cuota-item">
                    <div><b>Cuota ${c.n}</b><br><small style="color:var(--text-muted)">$${c.v.toLocaleString()}</small></div>
                    <span style="font-weight:800; color:${c.s==='pagado'?'var(--accent-green)':'#e2e8f0'}">${c.s.toUpperCase()}</span>
                </div>`);
            $("cliCuotas").innerHTML = h;
        });
    };

    async function loadAdmin() {
        const s = await getDocs(collection(db, "loans"));
        $("adminData").innerHTML = "";
        s.forEach(snap => {
            const l = snap.data();
            if(!l.name) return;
            
            let cHtml = l.plan.map((c, i) => `
                <div class="cuota-item">
                    <span>C${c.n} ($${c.v.toLocaleString()})</span>
                    <button class="pay-pill ${c.s==='pagado'?'done':''}" onclick="window.payC('${snap.id}', ${i})">${c.s==='pagado'?'PAGADO':'COBRAR'}</button>
                </div>`).join('');

            $("adminData").innerHTML += `
                <div class="loan-card">
                    <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:20px;">
                        <div>
                            <b style="font-size:20px;">${l.name}</b><br>
                            <small style="color:var(--text-muted)">DNI: ${l.dni} | Total: $${(l.amount * (1 + (tGlobal/100))).toLocaleString()}</small>
                        </div>
                        <button onclick="window.delL('${snap.id}')" style="background:#fee2e2; border:none; padding:12px; border-radius:15px; cursor:pointer;">üóëÔ∏è</button>
                    </div>
                    <div style="max-height:200px; overflow-y:auto; padding-right:10px;">${cHtml}</div>
                </div>`;
        });
    }

    window.payC = async (id, i) => {
        const dr = doc(db, "loans", id); const d = await getDoc(dr);
        let p = d.data().plan; p[i].s = "pagado";
        await updateDoc(dr, { plan: p });
        loadAdmin();
    };
    window.delL = async (id) => { if(confirm("¬øEliminar registro?")) { await deleteDoc(doc(db, "loans", id)); loadAdmin(); } };

    $("adminLogin").onclick = () => {
        const m = prompt("Email:"); const p = prompt("Pass:");
        if(m && p) signInWithEmailAndPassword(auth, m, p).catch(() => alert("Error de acceso"));
    };

    onAuthStateChanged(auth, u => {
        if(u && u.email === "fernandogastondelgado81@gmail.com") {
            $("user-ui").style.display = "none";
            $("hero").style.display = "none";
            $("exitContainer").classList.remove("hidden");
            $("admin-panel").style.display = "block";
            loadAdmin();
        }
    });
</script>
</body>
</html>
