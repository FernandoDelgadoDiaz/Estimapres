<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover"/>
  <title id="pageTitle">Prestify · Tu financiera, digitalizada</title>
  <link rel="icon" href="assets/ping.png"/>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* ========== CSS COMPLETO INCLUIDO AQUÍ ========== */
    
    /* ════════════════════════════════════════════════════════════════
       PRESTIFY · style.css
       SaaS Premium — VERSIÓN CORREGIDA FINAL
       ════════════════════════════════════════════════════════════════ */

    :root {
      --navy: #050d1f;
      --navy-card: #0c1e3d;
      --navy-input: #071428;
      --navy-row: #091630;
      --blue: #1a56db;
      --blue-light: #2f6ef5;
      --blue-glow: #3b7cf6;
      --sky: #60a5fa;
      --ice: #bfdbfe;
      --white: #ffffff;
      --text: #e8f0fe;
      --muted: #94b4d6;
      --border: rgba(96,165,250,.14);
      --border-hi: rgba(96,165,250,.38);
      --ok: #10b981;
      --ok-dim: rgba(16,185,129,.14);
      --warn: #f59e0b;
      --warn-dim: rgba(245,158,11,.14);
      --danger: #ef4444;
      --danger-dim: rgba(239,68,68,.14);
      --purple: #a78bfa;
      --purple-dim: rgba(167,139,250,.14);
      --teal: #06b6d4;
      --teal-dim: rgba(6,182,212,.14);
      --r: 20px;
      --ri: 12px;
      --sc: 0 8px 32px rgba(5,13,31,.65), 0 1px 0 rgba(96,165,250,.07) inset;
      --sb: 0 4px 20px rgba(26,86,219,.45);
    }

    @supports (padding: max(0px)) {
      :root {
        --sat: env(safe-area-inset-top);
        --sar: env(safe-area-inset-right);
        --sab: env(safe-area-inset-bottom);
        --sal: env(safe-area-inset-left);
      }
      body {
        padding-top: var(--sat);
        padding-bottom: var(--sab);
        padding-left: var(--sal);
        padding-right: var(--sar);
      }
      .topbar {
        padding-top: calc(14px + var(--sat));
      }
      .onboarding-overlay,
      .pending-overlay,
      .suspended-overlay,
      .modal-overlay {
        padding-top: calc(20px + var(--sat)) !important;
        padding-bottom: calc(20px + var(--sab)) !important;
      }
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'Sora', sans-serif;
      background: var(--navy);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.5;
    }

    body::before {
      content: '';
      position: fixed; inset: 0;
      pointer-events: none; z-index: 0;
      background:
        radial-gradient(ellipse 80% 60% at 70% -10%, rgba(26,86,219,.17) 0%, transparent 65%),
        radial-gradient(ellipse 50% 40% at 0% 100%, rgba(26,86,219,.11) 0%, transparent 60%),
        repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(96,165,250,.025) 40px),
        repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(96,165,250,.025) 40px);
    }

    ::-webkit-scrollbar { width: 6px; background: var(--navy); }
    ::-webkit-scrollbar-thumb { background: rgba(96,165,250,.18); border-radius: 999px; }

    @keyframes fadeUp { from { opacity:0; transform:translateY(14px) } to { opacity:1; transform:translateY(0) } }
    @keyframes fadeInUp { from { opacity:0; transform:translateY(32px) } to { opacity:1; transform:none } }
    @keyframes fadeInLeft { from { opacity:0; transform:translateX(-32px) } to { opacity:1; transform:none } }
    @keyframes fadeInRight { from { opacity:0; transform:translateX(32px) } to { opacity:1; transform:none } }
    @keyframes fadeInScale { from { opacity:0; transform:scale(.93) } to { opacity:1; transform:none } }
    @keyframes toastIn { from { opacity:0; transform:translateX(20px) } to { opacity:1; transform:translateX(0) } }
    @keyframes spin { to { transform:rotate(360deg) } }
    @keyframes spin-slow { to { transform:rotate(360deg) } }
    @keyframes slideDown {
      from { opacity:0; transform:translateX(-50%) translateY(-16px) }
      to { opacity:1; transform:translateX(-50%) translateY(0) }
    }
    @keyframes floatBadge { 0%,100% { transform:translateY(0) } 50% { transform:translateY(-8px) } }
    @keyframes floatPhone { 0%,100% { transform:translateY(0) rotate(-3deg) } 50% { transform:translateY(-16px) rotate(-3deg) } }
    @keyframes glowPulse { 0%,100% { opacity:.6 } 50% { opacity:1 } }
    @keyframes dotPulse { 0%,100% { box-shadow:0 0 0 0 rgba(52,211,153,.5) } 60% { box-shadow:0 0 0 8px rgba(52,211,153,0) } }
    @keyframes pulse-badge { 0%,100% { box-shadow:0 0 0 0 rgba(239,68,68,.6) } 60% { box-shadow:0 0 0 6px rgba(239,68,68,0) } }
    @keyframes pulse-danger { 0%,100% { box-shadow:0 0 0 0 rgba(239,68,68,.4) } 60% { box-shadow:0 0 0 16px rgba(239,68,68,0) } }
    @keyframes pulse-blue { 0%,100% { box-shadow:0 0 0 0 rgba(47,110,245,.4) } 60% { box-shadow:0 0 0 20px rgba(47,110,245,0) } }
    @keyframes blink-warn { 0%,100% { opacity:1 } 50% { opacity:.6 } }
    @keyframes shimmer { 0% { background-position:-200% 0 } 100% { background-position:200% 0 } }

    /* TOPBAR */
    .topbar {
      position: sticky; top: 0; z-index: 200;
      background: rgba(5,13,31,.92);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }
    .topbar-inner {
      max-width: 1200px; margin: 0 auto;
      padding: 0 28px; height: 66px;
      display: flex; align-items: center; gap: 24px;
    }

    .logo { display:flex; align-items:center; gap:10px; text-decoration:none; flex-shrink:0; cursor:pointer; }
    .logo-mark {
      width:38px; height:38px; border-radius:10px;
      background: linear-gradient(135deg, var(--blue-light), var(--sky));
      display:flex; align-items:center; justify-content:center;
      font-size:14px; font-weight:800; color:#fff;
      box-shadow: 0 0 18px rgba(47,110,245,.5);
      overflow: hidden;
    }
    .logo-mark img { width:100%; height:100%; object-fit:cover; border-radius:10px; }
    .logo-name { font-size:18px; font-weight:700; color:var(--white); letter-spacing:-.4px; }
    .logo-name span { color: var(--sky); }

    .topbar-nav { display:flex; align-items:center; gap:4px; margin-left:auto; }
    .nav-btn {
      display:inline-flex; align-items:center; gap:7px;
      padding:8px 13px; border-radius:10px;
      border:1px solid transparent; background:transparent;
      color:var(--muted); font-family:inherit; font-size:13px; font-weight:500;
      cursor:pointer; transition:all .2s; white-space:nowrap;
    }
    .nav-btn svg { width:15px; height:15px; stroke:currentColor; fill:none; stroke-width:2; flex-shrink:0; }
    .nav-btn:hover { background:rgba(96,165,250,.08); border-color:var(--border); color:var(--white); }
    .nav-btn.active { background:rgba(26,86,219,.15); border-color:var(--border-hi); color:var(--sky); }
    .nav-btn.danger { color:#f87171; }
    .nav-btn.danger:hover { background:var(--danger-dim); border-color:rgba(239,68,68,.3); }
    .nav-sep { width:1px; height:24px; background:var(--border); margin:0 4px; }

    .notif-wrap { position:relative; }
    .notif-bell {
      position:relative; display:inline-flex; align-items:center; justify-content:center;
      width:38px; height:38px; border-radius:10px;
      border:1px solid var(--border); background:transparent; color:var(--muted);
      cursor:pointer; transition:all .2s;
    }
    .notif-bell:hover { background:rgba(96,165,250,.08); border-color:var(--border-hi); color:var(--white); }
    .notif-bell svg { width:17px; height:17px; stroke:currentColor; fill:none; stroke-width:2; }
    .notif-badge {
      position:absolute; top:-5px; right:-5px;
      min-width:18px; height:18px; padding:0 4px;
      background:var(--danger); border-radius:9px; border:2px solid var(--navy);
      font-size:10px; font-weight:800; color:#fff;
      display:flex; align-items:center; justify-content:center;
      animation: pulse-badge 1.5s ease infinite;
    }
    .notif-dropdown {
      display:none; position:absolute; top:calc(100% + 10px); right:0;
      width:340px; background:var(--navy-card);
      border:1px solid var(--border-hi); border-radius:16px;
      box-shadow:0 16px 48px rgba(5,13,31,.8); z-index:500; overflow:hidden;
    }
    .notif-dropdown.open { display:block; animation:fadeUp .2s ease; }
    .notif-header {
      padding:14px 16px; border-bottom:1px solid var(--border);
      font-size:12px; font-weight:700; color:var(--sky);
      text-transform:uppercase; letter-spacing:1px;
      display:flex; justify-content:space-between; align-items:center;
    }
    .notif-list { max-height:300px; overflow-y:auto; }
    .notif-item { padding:12px 16px; border-bottom:1px solid rgba(96,165,250,.06); transition:background .15s; cursor:pointer; }
    .notif-item:hover { background:rgba(96,165,250,.05); }
    .notif-item.unread { border-left:3px solid var(--sky); }
    .notif-item-title { font-size:13px; font-weight:700; color:var(--white); margin-bottom:2px; }
    .notif-item-sub { font-size:11px; color:var(--muted); }
    .notif-empty { padding:24px; text-align:center; color:var(--muted); font-size:13px; }

    /* ALERT BANNER */
    .alert-banner {
      display:none; position:fixed; top:72px; left:50%; transform:translateX(-50%);
      z-index:400; padding:14px 20px 14px 18px;
      background:linear-gradient(135deg,rgba(26,86,219,.97),rgba(47,110,245,.97));
      border:1px solid rgba(96,165,250,.5); border-radius:14px;
      color:#fff; font-size:14px; font-weight:700;
      box-shadow:0 10px 40px rgba(26,86,219,.6);
      align-items:center; gap:12px; max-width:90vw;
    }
    .alert-banner.show { display:flex; animation:slideDown .35s ease; }
    .alert-banner-close {
      background:rgba(255,255,255,.18); border:none; color:#fff;
      width:22px; height:22px; border-radius:6px; cursor:pointer;
      font-size:13px; display:flex; align-items:center; justify-content:center;
      flex-shrink:0; margin-left:4px;
    }

    /* HERO SECTION */
    .hero-section {
      position:relative; z-index:1;
      max-width:1200px; margin:0 auto; padding:56px 28px 44px;
      display:grid; grid-template-columns:1fr auto; gap:40px; align-items:center;
    }
    .hero-eyebrow {
      display:inline-flex; align-items:center; gap:8px; padding:5px 12px;
      border-radius:999px; margin-bottom:18px;
      background:rgba(26,86,219,.18); border:1px solid var(--border-hi);
      font-size:11px; font-weight:600; color:var(--sky); letter-spacing:1.2px; text-transform:uppercase;
    }
    .hero-eyebrow::before { content:''; width:6px; height:6px; border-radius:50%; background:var(--sky); box-shadow:0 0 8px var(--sky); }
    .hero-title { font-size:clamp(30px,4vw,50px); font-weight:800; line-height:1.1; letter-spacing:-1.5px; color:var(--white); margin-bottom:14px; }
    .hero-title em { font-style:normal; background:linear-gradient(90deg,var(--sky),var(--blue-glow)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .hero-sub { font-size:15px; color:var(--muted); line-height:1.65; max-width:460px; }
    .hero-badges { display:flex; gap:10px; margin-top:28px; flex-wrap:wrap; }
    .badge {
      display:flex; align-items:center; gap:7px; padding:8px 13px;
      background:var(--navy-card); border:1px solid var(--border); border-radius:11px;
      font-size:12px; font-weight:600; color:var(--ice);
    }
    .badge svg { width:13px; height:13px; stroke:var(--sky); fill:none; stroke-width:2; }
    .hero-kpis { display:grid; gap:10px; }
    .kpi-box { background:var(--navy-card); border:1px solid var(--border); border-radius:16px; padding:18px 22px; text-align:right; min-width:170px; }
    .kpi-label { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:1px; font-weight:600; }
    .kpi-value { font-size:26px; font-weight:800; color:var(--white); letter-spacing:-1px; margin-top:4px; font-family:'DM Mono',monospace; }
    .kpi-value small { font-size:13px; color:var(--sky); margin-left:3px; font-family:'Sora',sans-serif; font-weight:600; }

    /* LAYOUT */
    .main-wrap { position:relative; z-index:1; max-width:1200px; margin:0 auto; padding:0 28px 80px; }
    .client-grid { display:grid; grid-template-columns:1fr 1fr; gap:22px; }
    .full-width { grid-column:1/-1; }
    .admin-wrap { display:none; }
    .admin-wrap.visible { display:block; }

    /* CARDS */
    .card {
      background:var(--navy-card); border:1px solid var(--border);
      border-radius:var(--r); padding:26px;
      box-shadow:var(--sc); position:relative; overflow:hidden;
      animation:fadeUp .4s ease both;
    }
    .card::before {
      content:''; position:absolute; top:0; left:0; right:0; height:1px;
      background:linear-gradient(90deg,transparent,rgba(96,165,250,.35),transparent);
    }
    .card-title {
      font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1.5px;
      color:var(--sky); margin-bottom:20px; display:flex; align-items:center; gap:8px;
    }
    .card-title svg { width:14px; height:14px; stroke:currentColor; fill:none; stroke-width:2.5; }
    .sep { height:1px; background:var(--border); margin:18px 0; }

    /* LOGIN GATE */
    .admin-gate {
      background: var(--navy-card);
      border: 1px solid var(--border-hi);
      border-radius: 20px;
      padding: 30px;
      max-width: 400px;
      margin: 40px auto;
    }
    .admin-gate input {
      width: 100%;
      padding: 14px 16px;
      margin-bottom: 12px;
      background: #071428;
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--white);
      font-size: 15px;
      font-family: 'Sora', sans-serif;
    }
    .admin-gate input:focus {
      outline: none;
      border-color: var(--sky);
      box-shadow: 0 0 0 3px rgba(96,165,250,.2);
    }
    .admin-gate button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--blue), var(--sky));
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      margin-top: 10px;
      font-family: 'Sora', sans-serif;
      transition: all .2s;
    }
    .admin-gate button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(26,86,219,.4);
    }
    .admin-gate a {
      color: var(--sky);
      text-decoration: none;
      font-size: 13px;
    }
    .admin-gate a:hover {
      text-decoration: underline;
    }

    /* DASHBOARD KPI CARDS */
    .dashboard-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:16px; margin-bottom:24px; }
    .dash-card {
      background:var(--navy-card); border:1px solid var(--border); border-radius:16px;
      padding:20px; position:relative; overflow:hidden;
      transition:transform .2s, border-color .2s;
    }
    .dash-card:hover { transform:translateY(-2px); border-color:var(--border-hi); }
    .dash-card::after { content:''; position:absolute; bottom:0; left:0; right:0; height:3px; }
    .dash-card.blue::after { background:linear-gradient(90deg,var(--blue),var(--sky)); }
    .dash-card.green::after { background:linear-gradient(90deg,#059669,var(--ok)); }
    .dash-card.red::after { background:linear-gradient(90deg,var(--danger),#f97316); }
    .dash-card.orange::after { background:linear-gradient(90deg,#ea580c,var(--warn)); }
    .dash-card.purple::after { background:linear-gradient(90deg,var(--purple),#ec4899); }

    .dash-icon { width:40px; height:40px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:14px; }
    .dash-icon svg { width:18px; height:18px; stroke:currentColor; fill:none; stroke-width:2; }
    .dash-icon.blue { background:rgba(26,86,219,.2); color:var(--sky); }
    .dash-icon.green { background:rgba(16,185,129,.2); color:var(--ok); }
    .dash-icon.red { background:var(--danger-dim); color:#f87171; }
    .dash-icon.orange { background:rgba(245,158,11,.15); color:var(--warn); }
    .dash-icon.purple { background:var(--purple-dim); color:var(--purple); }

    .dash-label { font-size:10px; color:var(--muted); font-weight:700; text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; }
    .dash-value { font-family:'DM Mono',monospace; font-size:22px; font-weight:700; color:var(--white); letter-spacing:-1px; line-height:1.2; }
    .dash-sub { font-size:11px; color:var(--muted); margin-top:5px; }

    .mora-rate-bar { height:5px; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden; margin-top:10px; }
    .mora-rate-fill { height:100%; border-radius:999px; background:linear-gradient(90deg,var(--ok),var(--warn),var(--danger)); transition:width .7s ease; }

    /* FORMS */
    .field { margin-bottom:16px; }
    .field label {
      display:block; font-size:11px; font-weight:700; color:var(--ice);
      text-transform:uppercase; letter-spacing:.9px; margin-bottom:7px;
    }
    .field input, .field select, .field textarea {
      width:100%; background:rgba(7,20,40,.85); border:1px solid rgba(96,165,250,.28);
      border-radius:var(--ri); padding:12px 15px; color:#f0f6ff;
      font-family:'Sora',sans-serif; font-size:14px; font-weight:500;
      transition:border-color .2s, box-shadow .2s, background .2s; outline:none;
    }
    .field textarea { resize:vertical; min-height:80px; }
    .field input::placeholder, .field textarea::placeholder { color:rgba(148,180,214,.5); font-weight:400; }
    .field input:focus, .field select:focus, .field textarea:focus {
      border-color:var(--blue-glow); box-shadow:0 0 0 3px rgba(59,124,246,.18);
      background:rgba(7,20,40,.95); color:#fff;
    }
    .field input.mono { font-family:'DM Mono',monospace; font-size:16px; }
    .field select { cursor:pointer; }
    .field select option { background:var(--navy-card); color:var(--white); }
    .field-hint { font-size:11px; color:var(--muted); margin-top:5px; line-height:1.5; }

    .input-row { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    .input-row3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px; }

    /* BUTTONS */
    .btn-primary {
      width:100%; padding:13px 20px; border:none; border-radius:var(--ri);
      background:linear-gradient(135deg,var(--blue-light),var(--blue));
      color:#fff; font-family:'Sora',sans-serif; font-size:14px; font-weight:700;
      cursor:pointer; box-shadow:var(--sb); transition:transform .15s, box-shadow .15s;
      display:flex; align-items:center; justify-content:center; gap:8px;
    }
    .btn-primary:hover { transform:translateY(-1px); box-shadow:0 6px 28px rgba(26,86,219,.55); }
    .btn-primary:disabled { opacity:.4; cursor:not-allowed; transform:none; }
    .btn-primary svg { width:15px; height:15px; stroke:currentColor; fill:none; stroke-width:2.5; }

    .btn-success {
      padding:10px 16px; background:var(--ok-dim); border:1px solid rgba(16,185,129,.3);
      border-radius:10px; color:var(--ok); font-family:'Sora',sans-serif; font-size:13px; font-weight:700;
      cursor:pointer; transition:all .2s; display:inline-flex; align-items:center; gap:6px;
    }
    .btn-success:hover { background:rgba(16,185,129,.22); }
    .btn-success:disabled { opacity:.35; cursor:not-allowed; }

    .btn-danger {
      padding:10px 16px; background:var(--danger-dim); border:1px solid rgba(239,68,68,.25);
      border-radius:10px; color:#f87171; font-family:'Sora',sans-serif; font-size:13px; font-weight:700;
      cursor:pointer; transition:all .2s;
    }
    .btn-danger:hover { background:rgba(239,68,68,.22); }

    .btn-outline {
      padding:10px 16px; background:transparent; border:1px solid var(--border);
      border-radius:10px; color:var(--ice); font-family:'Sora',sans-serif; font-size:13px; font-weight:600;
      cursor:pointer; transition:all .2s; display:inline-flex; align-items:center; gap:6px;
    }
    .btn-outline:hover { border-color:var(--border-hi); color:var(--white); }

    .btn-wa {
      padding:9px 14px; background:rgba(37,211,102,.12); border:1px solid rgba(37,211,102,.28);
      border-radius:10px; color:#25d366; font-family:'Sora',sans-serif; font-size:12px; font-weight:700;
      cursor:pointer; transition:all .2s; display:inline-flex; align-items:center; gap:6px;
      text-decoration:none; white-space:nowrap;
    }
    .btn-wa:hover { background:rgba(37,211,102,.22); border-color:rgba(37,211,102,.45); }
    .btn-wa svg { width:13px; height:13px; fill:currentColor; }

    .btn-sm { padding:6px 11px !important; font-size:11px !important; }

    .btn-pay {
      padding:7px 14px; background:linear-gradient(135deg,rgba(16,185,129,.2),rgba(16,185,129,.1));
      border:1px solid rgba(16,185,129,.35); border-radius:8px; color:var(--ok);
      font-family:'Sora',sans-serif; font-size:12px; font-weight:700;
      cursor:pointer; transition:all .2s; display:inline-flex; align-items:center; gap:5px;
    }
    .btn-pay:hover { background:rgba(16,185,129,.25); border-color:rgba(16,185,129,.5); transform:translateY(-1px); }
    .btn-pay svg { width:12px; height:12px; stroke:currentColor; fill:none; stroke-width:2.5; }

    .btn-mp {
      padding:7px 14px; background:linear-gradient(135deg,rgba(0,168,90,.18),rgba(0,168,90,.08));
      border:1px solid rgba(0,168,90,.38); border-radius:8px; color:#00c87a;
      font-family:'Sora',sans-serif; font-size:12px; font-weight:700;
      cursor:pointer; transition:all .2s; display:inline-flex; align-items:center; gap:6px; text-decoration:none;
    }
    .btn-mp:hover { background:rgba(0,168,90,.28); border-color:rgba(0,168,90,.55); transform:translateY(-1px); }

    .btn-comp {
      padding:7px 14px; background:rgba(245,158,11,.1); border:1px solid rgba(245,158,11,.3);
      border-radius:8px; color:#fbbf24; font-family:'Sora',sans-serif; font-size:12px; font-weight:700;
      cursor:pointer; transition:all .2s; display:inline-flex; align-items:center; gap:5px;
    }
    .btn-comp:hover { background:rgba(245,158,11,.2); border-color:rgba(245,158,11,.5); }
    .btn-comp svg { width:12px; height:12px; stroke:currentColor; fill:none; stroke-width:2.5; }

    .btn-copy-link {
      padding:10px 18px;
      background:linear-gradient(135deg,rgba(96,165,250,.15),rgba(47,110,245,.1));
      border:1px solid var(--border-hi); border-radius:10px; color:var(--sky);
      font-family:'Sora',sans-serif; font-size:13px; font-weight:700;
      cursor:pointer; transition:all .2s; display:inline-flex; align-items:center; gap:8px;
    }
    .btn-copy-link:hover { background:rgba(96,165,250,.2); border-color:rgba(96,165,250,.5); transform:translateY(-1px); }
    .btn-copy-link svg { width:14px; height:14px; stroke:currentColor; fill:none; stroke-width:2; }

    /* PILLS */
    .toolbar { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .pill { display:inline-flex; align-items:center; gap:5px; padding:3px 9px; border-radius:999px; font-size:11px; font-weight:700; }
    .pill::before { content:''; width:5px; height:5px; border-radius:50%; flex-shrink:0; }
    .pill.ok { background:var(--ok-dim); color:#34d399; border:1px solid rgba(16,185,129,.25); } .pill.ok::before { background:var(--ok); }
    .pill.warn { background:var(--warn-dim); color:#fbbf24; border:1px solid rgba(245,158,11,.25); } .pill.warn::before { background:var(--warn); }
    .pill.bad { background:var(--danger-dim); color:#f87171; border:1px solid rgba(239,68,68,.25); } .pill.bad::before { background:var(--danger); }
    .pill.purple { background:var(--purple-dim); color:var(--purple); border:1px solid rgba(167,139,250,.25); } .pill.purple::before { background:var(--purple); }
    .pill.teal { background:var(--teal-dim); color:var(--teal); border:1px solid rgba(6,182,212,.25); } .pill.teal::before { background:var(--teal); }

    /* PAYMENT SCHEDULE */
    .schedule-wrap { border:1px solid var(--border); border-radius:14px; overflow:hidden; margin-top:14px; }
    .schedule-header {
      display:grid; grid-template-columns:38px 1fr 110px 1fr; gap:8px;
      padding:9px 14px; background:rgba(5,13,31,.65); border-bottom:1px solid var(--border);
    }
    .schedule-header span { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:1.1px; color:var(--muted); }
    .schedule-row {
      display:grid; grid-template-columns:38px 1fr 110px 1fr; gap:8px;
      align-items:center; padding:11px 14px; border-bottom:1px solid rgba(96,165,250,.05); transition:background .15s;
    }
    .schedule-row:last-child { border-bottom:none; }
    .schedule-row:hover { background:rgba(96,165,250,.04); }
    .schedule-row.is-paid { opacity:.6; }
    .schedule-row.is-late { background:rgba(239,68,68,.03); }
    .schedule-row .num { font-family:'DM Mono',monospace; font-size:12px; color:var(--muted); }
    .schedule-row .date { font-size:13px; color:var(--ice); font-weight:500; }
    .schedule-row .amount { font-family:'DM Mono',monospace; font-size:13px; color:var(--white); font-weight:600; }
    .schedule-row .action-col { display:flex; align-items:center; gap:6px; flex-wrap:wrap; }

    /* SIMULATOR */
    .sim-meta { display:flex; gap:16px; padding:10px 14px; background:rgba(5,13,31,.5); border:1px solid var(--border); border-radius:10px; margin-bottom:18px; flex-wrap:wrap; }
    .sim-meta-item { font-size:12px; font-weight:600; color:var(--muted); }
    .sim-meta-item strong { color:var(--sky); font-family:'DM Mono',monospace; }

    .sim-deduction-badge {
      display:flex; align-items:center; gap:8px; padding:8px 12px;
      background:rgba(245,158,11,.08); border:1px solid rgba(245,158,11,.2);
      border-radius:10px; margin-bottom:14px; font-size:12px; color:#fbbf24;
    }
    .sim-deduction-badge svg { width:13px; height:13px; stroke:currentColor; fill:none; stroke-width:2; flex-shrink:0; }

    .sim-result-box { margin-top:18px; padding:18px; background:rgba(5,13,31,.5); border:1px solid var(--border-hi); border-radius:16px; }
    .sim-cuota-display { display:flex; align-items:baseline; gap:10px; margin-bottom:6px; }
    .sim-cuota-label { font-size:12px; color:var(--muted); font-weight:600; text-transform:uppercase; letter-spacing:1px; }
    .sim-cuota-value { font-family:'DM Mono',monospace; font-size:30px; color:var(--sky); letter-spacing:-1px; }
    .sim-neto-badge {
      display:inline-flex; align-items:center; gap:6px; padding:4px 10px;
      background:rgba(16,185,129,.1); border:1px solid rgba(16,185,129,.2);
      border-radius:8px; font-size:12px; color:var(--ok); font-weight:700; margin-bottom:14px;
    }

    /* LOAN ITEMS */
    .loan-item { padding:15px; background:var(--navy-row); border:1px solid var(--border); border-radius:13px; margin-bottom:9px; transition:border-color .2s; }
    .loan-item:hover { border-color:var(--border-hi); }
    .loan-item:last-child { margin-bottom:0; }
    .loan-name { font-size:15px; font-weight:700; color:var(--white); margin-bottom:4px; }
    .loan-meta { font-size:12px; color:var(--muted); display:flex; flex-wrap:wrap; gap:10px; }
    .loan-meta strong { color:var(--ice); }
    .loan-notes { margin-top:10px; font-size:12px; color:var(--muted); background:rgba(26,86,219,.06); border:1px solid var(--border); border-radius:8px; padding:8px 10px; }
    .loan-notes strong { color:var(--sky); }

    /* ADMIN TABS */
    .admin-tabs { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:20px; }
    .tab-btn {
      padding:9px 16px; border-radius:10px; border:1px solid var(--border); background:transparent;
      color:var(--muted); font-family:'Sora',sans-serif; font-size:13px; font-weight:600;
      cursor:pointer; transition:all .2s; display:flex; align-items:center; gap:6px;
    }
    .tab-btn:hover { border-color:var(--border-hi); color:var(--white); }
    .tab-btn.active { background:rgba(26,86,219,.18); border-color:var(--border-hi); color:var(--sky); }
    .tab-badge { background:var(--blue); color:#fff; font-size:10px; font-weight:700; padding:1px 6px; border-radius:999px; }
    .tab-badge.warn { background:var(--warn); }
    .tab-badge.bad { background:var(--danger); }
    .tab-content { display:none; }
    .tab-content.visible { display:block; }

    /* MORA TABLE */
    .mora-table { display:flex; flex-direction:column; gap:8px; }
    .mora-row {
      display:grid; grid-template-columns:1fr 80px 120px 130px 160px; gap:10px;
      align-items:center; padding:14px 16px;
      background:var(--navy-row); border:1px solid var(--border); border-radius:12px; transition:border-color .2s;
    }
    .mora-row:hover { border-color:var(--border-hi); }
    .mora-row.grave { border-left:3px solid var(--danger); }
    .mora-row.media { border-left:3px solid var(--warn); }
    .mora-row.leve { border-left:3px solid var(--teal); }
    .mora-name { font-size:14px; font-weight:700; color:var(--white); }
    .mora-sub { font-size:11px; color:var(--muted); margin-top:2px; }
    .mora-dias { font-family:'DM Mono',monospace; font-size:20px; font-weight:800; line-height:1; }
    .mora-dias-label { font-size:10px; text-transform:uppercase; letter-spacing:.8px; font-weight:600; margin-top:1px; }
    .mora-dias.grave, .mora-dias-label.grave { color:#f87171; }
    .mora-dias.media, .mora-dias-label.media { color:#fbbf24; }
    .mora-dias.leve, .mora-dias-label.leve { color:var(--teal); }
    .mora-amount { font-family:'DM Mono',monospace; font-size:14px; font-weight:700; color:var(--white); }
    .mora-amount-label { font-size:10px; color:var(--muted); }
    .mora-summary { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:18px; }
    .mora-sum-box { padding:14px 16px; background:var(--navy-row); border:1px solid var(--border); border-radius:12px; text-align:center; }
    .mora-sum-value { font-family:'DM Mono',monospace; font-size:20px; font-weight:800; color:var(--white); }
    .mora-sum-label { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:.8px; margin-top:3px; }

    /* CONFIGURATION */
    .logo-upload-wrap {
      display:flex; align-items:center; gap:16px; padding:14px;
      background:rgba(5,13,31,.4); border:1px solid var(--border); border-radius:14px; margin-bottom:16px;
    }
    .logo-preview-box {
      width:56px; height:56px; border-radius:12px;
      background:linear-gradient(135deg,var(--blue-light),var(--sky));
      display:flex; align-items:center; justify-content:center;
      font-size:20px; font-weight:800; color:#fff; flex-shrink:0; overflow:hidden;
    }
    .logo-preview-box img { width:100%; height:100%; object-fit:cover; border-radius:12px; }
    .logo-upload-info { flex:1; }
    .logo-upload-info h4 { font-size:13px; font-weight:700; color:var(--white); margin-bottom:3px; }
    .logo-upload-info p { font-size:11px; color:var(--muted); }
    .cfg-section { margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid var(--border); }
    .cfg-section:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
    .cfg-section-title {
      font-size:12px; font-weight:700; color:var(--sky); text-transform:uppercase;
      letter-spacing:1px; margin-bottom:14px; display:flex; align-items:center; gap:6px;
    }
    .cfg-section-title svg { width:13px; height:13px; stroke:currentColor; fill:none; stroke-width:2; }

    /* Plazo checkboxes */
    .plazo-grid { display:grid; grid-template-columns:repeat(8,1fr); gap:6px; margin-top:8px; }
    .plazo-check { display:none; }
    .plazo-label {
      display:flex; align-items:center; justify-content:center; height:34px;
      border:1px solid var(--border); border-radius:8px; font-size:12px; font-weight:700;
      color:var(--muted); cursor:pointer; transition:all .15s; font-family:'DM Mono',monospace;
    }
    .plazo-label:hover { border-color:var(--border-hi); color:var(--ice); }
    .plazo-check:checked + .plazo-label { background:rgba(26,86,219,.2); border-color:var(--sky); color:var(--sky); }

    /* BREAKDOWN BOX */
    .breakdown-box { background:rgba(5,13,31,.5); border:1px solid var(--border-hi); border-radius:12px; padding:14px; margin-bottom:12px; }
    .breakdown-row { display:flex; justify-content:space-between; align-items:center; padding:5px 0; border-bottom:1px solid rgba(96,165,250,.06); font-size:12px; }
    .breakdown-row:last-child { border-bottom:none; font-weight:700; font-size:13px; color:var(--white); padding-top:10px; margin-top:4px; }
    .breakdown-row .bl { color:var(--muted); }
    .breakdown-row .bv { font-family:'DM Mono',monospace; color:var(--ice); }
    .breakdown-row.accent .bv { color:var(--sky); font-size:14px; }
    .breakdown-row.warn-row .bv { color:var(--warn); }

    /* PROGRESS BAR */
    .progress-bar-wrap { height:6px; background:rgba(96,165,250,.12); border-radius:999px; overflow:hidden; margin-top:10px; }
    .progress-bar-fill { height:100%; background:linear-gradient(90deg,var(--blue),var(--sky)); border-radius:999px; transition:width .6s ease; }

    /* MY LOAN STATUS */
    .myloan-status {
      display:flex; align-items:center; justify-content:space-between; padding:15px 18px;
      background:rgba(26,86,219,.08); border:1px solid var(--border-hi); border-radius:13px;
      margin-bottom:16px; flex-wrap:wrap; gap:10px;
    }
    .myloan-name { font-size:16px; font-weight:800; color:var(--white); margin-bottom:3px; }
    .myloan-meta { font-size:13px; color:var(--muted); }

    /* MODALS */
    .modal-overlay {
      display:none; position:fixed; inset:0; z-index:300;
      background:rgba(5,13,31,.92); backdrop-filter:blur(10px);
      align-items:center; justify-content:center; padding:calc(20px + env(safe-area-inset-top, 20px)) 20px calc(20px + env(safe-area-inset-bottom, 20px));
      overflow-y: auto;
    }
    .modal-overlay.open { display:flex; }
    .modal-box {
      background:var(--navy-card); border:1px solid var(--border-hi); border-radius:22px;
      padding:26px; width:100%; max-width:460px; box-shadow:0 24px 60px rgba(5,13,31,.8);
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-title { font-size:18px; font-weight:800; color:var(--white); margin-bottom:6px; }
    .modal-sub { font-size:13px; color:var(--muted); margin-bottom:18px; line-height:1.55; }
    .sig-canvas-wrap { border:2px dashed var(--border-hi); border-radius:14px; overflow:hidden; background:rgba(5,13,31,.6); touch-action:none; }
    #sigCanvas { display:block; width:100%; height:170px; cursor:crosshair; }
    .sig-actions { display:flex; gap:10px; margin-top:12px; }
    .modal-note {
      font-size:11px; color:var(--muted); margin-top:12px; line-height:1.5;
      padding:10px 12px; background:rgba(26,86,219,.08); border-radius:10px; border-left:3px solid var(--border-hi);
    }
    .activate-summary { background:rgba(5,13,31,.5); border:1px solid var(--border); border-radius:12px; padding:14px; margin-bottom:16px; }
    .activate-row { display:flex; justify-content:space-between; align-items:center; padding:7px 0; border-bottom:1px solid var(--border); font-size:13px; }
    .activate-row:last-child { border-bottom:none; font-weight:700; color:var(--white); font-size:14px; }
    .activate-row .l { color:var(--muted); }
    .activate-row .v { font-family:'DM Mono',monospace; color:var(--ice); }

    /* SEARCH INPUT */
    .search-input {
      flex:1; background:rgba(7,20,40,.8); border:1px solid rgba(96,165,250,.2);
      border-radius:10px; padding:9px 14px; color:var(--white);
      font-family:'Sora',sans-serif; font-size:13px; outline:none;
    }
    .search-input:focus { border-color:var(--blue-glow); }
    .search-input::placeholder { color:rgba(148,180,214,.45); }

    /* TOASTS */
    .toast-container { position:fixed; bottom:24px; right:24px; z-index:999; display:flex; flex-direction:column; gap:8px; pointer-events:none; }
    .toast {
      padding:12px 18px; border-radius:12px; font-size:13px; font-weight:600;
      display:flex; align-items:center; gap:10px;
      pointer-events:auto; animation:toastIn .3s ease; box-shadow:0 8px 24px rgba(5,13,31,.6);
    }
    .toast.ok { background:#0c2e1f; border:1px solid rgba(16,185,129,.3); color:#34d399; }
    .toast.err { background:#2a0c0c; border:1px solid rgba(239,68,68,.3); color:#f87171; }
    .toast.info { background:#0c1e3d; border:1px solid var(--border-hi); color:var(--sky); }
    .toast.new-req {
      background:linear-gradient(135deg,#08183a,#0c2264); border:1px solid rgba(96,165,250,.45);
      color:#fff; font-size:14px; padding:14px 20px; cursor:pointer; gap:14px; max-width:340px;
    }

    /* UTILS */
    .empty { padding:28px 20px; text-align:center; color:var(--muted); font-size:13px; }
    .spinner { width:20px; height:20px; border:2px solid rgba(96,165,250,.2); border-top-color:var(--sky); border-radius:50%; animation:spin .8s linear infinite; margin:0 auto; }

    /* OVERLAYS */
    .suspended-overlay {
      display:none; position:fixed; inset:0; z-index:9999;
      background:rgba(5,13,31,.97); backdrop-filter:blur(16px);
      align-items:center; justify-content:center; flex-direction:column;
      gap:20px; text-align:center; padding:calc(30px + env(safe-area-inset-top, 30px)) 30px calc(30px + env(safe-area-inset-bottom, 30px));
      overflow-y: auto;
    }
    .suspended-overlay.show { display:flex; }
    .suspended-icon {
      width:80px; height:80px; border-radius:20px;
      background:var(--danger-dim); border:2px solid rgba(239,68,68,.4);
      display:flex; align-items:center; justify-content:center;
      animation: pulse-danger 2s ease infinite;
    }
    .suspended-icon svg { width:36px; height:36px; stroke:#f87171; fill:none; stroke-width:1.5; }
    .suspended-title { font-size:24px; font-weight:800; color:#f87171; letter-spacing:-.5px; }
    .suspended-msg { font-size:15px; color:var(--muted); line-height:1.65; max-width:460px; }
    .suspended-msg strong { color:var(--ice); }
    .suspended-contact-btn {
      padding:13px 28px; background:rgba(239,68,68,.15); border:1px solid rgba(239,68,68,.35);
      border-radius:12px; color:#f87171; font-weight:700; font-size:14px; text-decoration:none; margin-top:8px;
      display:inline-flex; align-items:center;
    }

    .pending-overlay {
      display:none; position:fixed; inset:0; z-index:8000;
      background:rgba(5,13,31,.98); backdrop-filter:blur(20px);
      align-items:center; justify-content:center; flex-direction:column;
      gap:22px; text-align:center; padding:calc(30px + env(safe-area-inset-top, 30px)) 30px calc(30px + env(safe-area-inset-bottom, 30px));
      overflow-y: auto;
    }
    .pending-overlay.show { display:flex; }
    .pending-logo-wrap { display:flex; flex-direction:column; align-items:center; gap:10px; margin-bottom:8px; }
    .pending-logo-mark {
      width:72px; height:72px; border-radius:18px;
      background:linear-gradient(135deg,var(--blue-light),var(--sky));
      display:flex; align-items:center; justify-content:center;
      font-size:26px; font-weight:800; color:#fff;
      box-shadow:0 0 36px rgba(47,110,245,.5);
      animation: pulse-blue 2.5s ease infinite;
    }
    .pending-logo-name { font-size:22px; font-weight:800; color:var(--white); letter-spacing:-.5px; }
    .pending-logo-name span { color:var(--sky); }
    .pending-title { font-size:20px; font-weight:800; color:var(--white); letter-spacing:-.3px; }
    .pending-msg { font-size:14px; color:var(--muted); line-height:1.7; max-width:420px; }
    .pending-msg strong { color:var(--ice); }
    .pending-badge {
      display:inline-flex; align-items:center; gap:8px; padding:8px 16px;
      background:var(--warn-dim); border:1px solid rgba(245,158,11,.3); border-radius:999px;
      font-size:12px; font-weight:700; color:var(--warn);
      animation: blink-warn 2s ease infinite;
    }
    .pending-badge::before { content:''; width:7px; height:7px; border-radius:50%; background:var(--warn); }
    .pending-wa-btn {
      padding:14px 28px; background:rgba(37,211,102,.15); border:1px solid rgba(37,211,102,.35);
      border-radius:12px; color:#25d366; font-weight:700; font-size:14px; text-decoration:none;
      display:flex; align-items:center; gap:10px; margin-top:4px;
    }
    .pending-wa-btn svg { width:18px; height:18px; fill:currentColor; }
    .pending-logout-btn {
      padding:9px 20px; background:transparent; border:1px solid var(--border);
      border-radius:10px; color:var(--muted); font-family:inherit; font-size:13px; cursor:pointer; margin-top:4px;
    }

    /* ONBOARDING */
    .onboarding-overlay {
      display:none; position:fixed; inset:0; z-index:600;
      background:rgba(5,13,31,.97); backdrop-filter:blur(20px);
      align-items:center; justify-content:center; padding:calc(20px + env(safe-area-inset-top, 20px)) 20px calc(20px + env(safe-area-inset-bottom, 20px));
      overflow-y: auto;
    }
    .onboarding-overlay.show { display:flex; }
    .onboarding-box {
      background:var(--navy-card); border:1px solid var(--border-hi); border-radius:24px;
      padding:36px; width:100%; max-width:540px; box-shadow:0 32px 80px rgba(5,13,31,.9);
      animation:fadeUp .4s ease both;
      max-height: 90vh;
      overflow-y: auto;
    }

    .ob-steps { display:flex; gap:0; margin-bottom:32px; position:relative; }
    .ob-steps::before { content:''; position:absolute; top:16px; left:16px; right:16px; height:2px; background:var(--border); z-index:0; }
    .ob-step { display:flex; flex-direction:column; align-items:center; flex:1; position:relative; z-index:1; }
    .ob-step-dot {
      width:32px; height:32px; border-radius:50%; border:2px solid var(--border); background:var(--navy);
      display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; color:var(--muted);
      transition:all .3s; flex-shrink:0;
    }
    .ob-step.active .ob-step-dot { border-color:var(--sky); background:rgba(96,165,250,.15); color:var(--sky); }
    .ob-step.done .ob-step-dot { border-color:var(--ok); background:rgba(16,185,129,.15); color:var(--ok); }
    .ob-step-label { font-size:10px; font-weight:600; color:var(--muted); margin-top:6px; text-align:center; letter-spacing:.5px; text-transform:uppercase; }
    .ob-step.active .ob-step-label { color:var(--sky); }
    .ob-step.done .ob-step-label { color:var(--ok); }

    .ob-content { display:none; }
    .ob-content.active { display:block; animation:fadeUp .3s ease both; }
    .ob-title { font-size:20px; font-weight:800; color:var(--white); margin-bottom:6px; letter-spacing:-.4px; }
    .ob-subtitle { font-size:13px; color:var(--muted); margin-bottom:24px; line-height:1.6; }
    .ob-nav { display:flex; gap:10px; margin-top:20px; }

    .ob-consent-box { background:rgba(5,13,31,.6); border:1px solid var(--border); border-radius:14px; padding:16px; margin-bottom:20px; max-height:140px; overflow-y:auto; }
    .ob-consent-box p { font-size:11px; color:var(--muted); line-height:1.7; margin-bottom:6px; }
    .ob-consent-box strong { color:var(--ice); }
    .ob-consent-check {
      display:flex; align-items:flex-start; gap:10px; padding:12px 14px;
      background:rgba(26,86,219,.08); border:1px solid var(--border-hi);
      border-radius:10px; cursor:pointer; margin-bottom:20px;
    }
    .ob-consent-check input[type=checkbox] { width:16px; height:16px; margin-top:1px; flex-shrink:0; accent-color:var(--sky); cursor:pointer; }
    .ob-consent-check label { font-size:12px; color:var(--ice); line-height:1.5; cursor:pointer; }

    .ob-sig-wrap { border:2px dashed var(--border-hi); border-radius:14px; overflow:hidden; background:rgba(5,13,31,.6); touch-action:none; margin-bottom:16px; }
    #obSigCanvas { display:block; width:100%; height:150px; cursor:crosshair; }

    .payment-method-selector { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px; }
    .pm-option { padding:16px; border:2px solid var(--border); border-radius:14px; cursor:pointer; transition:all .2s; text-align:center; }
    .pm-option:hover { border-color:var(--border-hi); }
    .pm-option.selected { border-color:var(--sky); background:rgba(96,165,250,.08); }
    .pm-option .pm-icon { font-size:24px; margin-bottom:8px; }
    .pm-option .pm-name { font-size:13px; font-weight:700; color:var(--white); }
    .pm-option .pm-desc { font-size:11px; color:var(--muted); margin-top:3px; line-height:1.4; }

    /* SUPERADMIN PANEL */
    .superadmin-view { display:none; position:relative; z-index:1; max-width:1200px; margin:0 auto; padding:32px 28px 80px; }
    .superadmin-view.show { display:block; }
    .sa-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:28px; gap:16px; flex-wrap:wrap; }
    .sa-title { font-size:26px; font-weight:800; color:var(--white); letter-spacing:-1px; display:flex; align-items:center; gap:12px; }
    .sa-title .sa-badge {
      display:inline-flex; align-items:center; gap:6px; padding:4px 10px;
      background:rgba(239,68,68,.15); border:1px solid rgba(239,68,68,.35); border-radius:999px;
      font-size:11px; font-weight:700; color:#f87171; letter-spacing:1px; text-transform:uppercase;
    }
    .sa-metrics { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:28px; }
    .sa-metric-card { background:var(--navy-card); border:1px solid var(--border); border-radius:16px; padding:20px; }
    .sa-metric-label { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:1px; font-weight:700; margin-bottom:8px; }
    .sa-metric-val { font-family:'DM Mono',monospace; font-size:28px; font-weight:800; color:var(--white); letter-spacing:-1px; }
    .sa-lenders-table { background:var(--navy-card); border:1px solid var(--border); border-radius:20px; overflow:hidden; }
    .sa-table-header { padding:18px 24px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
    .sa-table-title { font-size:13px; font-weight:700; color:var(--sky); text-transform:uppercase; letter-spacing:1px; }
    .sa-row { display:grid; grid-template-columns:1fr 200px 120px 140px; gap:16px; align-items:center; padding:16px 24px; border-bottom:1px solid rgba(96,165,250,.06); transition:background .15s; }
    .sa-row:hover { background:rgba(96,165,250,.03); }
    .sa-row:last-child { border-bottom:none; }
    .sa-row-head { background:rgba(5,13,31,.5); font-size:10px; font-weight:700; color:var(--muted); text-transform:uppercase; letter-spacing:1px; }
    .sa-lender-name { font-size:14px; font-weight:700; color:var(--white); }
    .sa-lender-email { font-size:11px; color:var(--muted); margin-top:2px; }
    .sa-lender-id { font-size:10px; color:rgba(96,165,250,.5); font-family:'DM Mono',monospace; margin-top:3px; }
    .sa-status-pill { display:inline-flex; align-items:center; gap:5px; padding:4px 10px; border-radius:999px; font-size:11px; font-weight:700; }
    .sa-status-pill.activo { background:var(--ok-dim); color:var(--ok); border:1px solid rgba(16,185,129,.25); }
    .sa-status-pill.pendiente { background:var(--warn-dim); color:var(--warn); border:1px solid rgba(245,158,11,.25); }
    .sa-status-pill.pausado { background:var(--danger-dim); color:#f87171; border:1px solid rgba(239,68,68,.25); }
    .sa-action-btn { padding:7px 14px; border-radius:8px; font-family:'Sora',sans-serif; font-size:12px; font-weight:700; cursor:pointer; transition:all .2s; border:1px solid; }
    .sa-btn-activate { background:var(--ok-dim); border-color:rgba(16,185,129,.3); color:var(--ok); }
    .sa-btn-activate:hover { background:rgba(16,185,129,.22); }
    .sa-btn-suspend { background:var(--danger-dim); border-color:rgba(239,68,68,.25); color:#f87171; }
    .sa-btn-suspend:hover { background:rgba(239,68,68,.22); }
    .sa-loading { padding:40px; text-align:center; color:var(--muted); }

    /* SUCCESS CARD */
    .req-success-card {
      display:flex; align-items:center; gap:14px; padding:16px 18px;
      background:#f0fff8; border:1.5px solid rgba(16,185,129,.35); border-radius:14px;
      margin-top:14px; animation:fadeUp .35s ease;
    }
    .req-success-icon {
      width:40px; height:40px; border-radius:50%; background:#10b981; color:#fff;
      font-size:18px; font-weight:900; display:flex; align-items:center; justify-content:center; flex-shrink:0;
    }
    .req-success-title { font-size:14px; font-weight:800; color:#065f46; margin-bottom:2px; }
    .req-success-sub { font-size:12px; color:#047857; line-height:1.5; }

    /* CLIENT MODE */
    body.client-mode { background:#F5F7FA; }
    body.client-mode::before { display:none; }
    body.client-mode .topbar { background:rgba(255,255,255,.95); border-bottom:1px solid rgba(0,0,0,.08); box-shadow:0 2px 12px rgba(0,0,0,.06); }
    body.client-mode .logo-name { color:#111; }
    body.client-mode .nav-btn { color:#666; }
    body.client-mode .nav-btn:hover { background:rgba(0,0,0,.05); color:#111; border-color:rgba(0,0,0,.1); }
    body.client-mode .nav-btn.active { background:rgba(0,0,0,.07); color:#111; border-color:rgba(0,0,0,.15); }
    body.client-mode .hero-section { display:none; }
    body.client-mode .card { background:#fff; border:1px solid rgba(0,0,0,.07); box-shadow:0 4px 24px rgba(0,0,0,.06), 0 1px 4px rgba(0,0,0,.04); border-radius:20px; }
    body.client-mode .card::before { display:none; }
    body.client-mode .card-title { color:#555; letter-spacing:1px; }
    body.client-mode .lender-brand-header { text-align:center; padding:28px 20px 8px; }
    body.client-mode .lender-brand-name { font-size:clamp(26px,5vw,38px); font-weight:800; color:#111; letter-spacing:-1px; margin-bottom:6px; }
    body.client-mode .lender-brand-tagline { font-size:14px; color:#888; font-weight:400; }
    body.client-mode .field label { color:#444; text-transform:none; font-size:13px; font-weight:600; letter-spacing:0; }
    body.client-mode .field input,
    body.client-mode .field select,
    body.client-mode .field textarea { background:#F5F7FA; border:1.5px solid #E2E8F0; color:#111; border-radius:14px; }
    body.client-mode .field input::placeholder { color:#aaa; }
    body.client-mode .field input:focus,
    body.client-mode .field select:focus { background:#fff; border-color:var(--brand-color,#1a56db); box-shadow:0 0 0 3px color-mix(in srgb,var(--brand-color,#1a56db) 15%,transparent); color:#111; }
    body.client-mode .client-amount-slider {
      -webkit-appearance:none; appearance:none; width:100%; height:6px;
      border-radius:999px; background:#E2E8F0; outline:none; cursor:pointer; margin:12px 0 4px;
    }
    body.client-mode .client-amount-slider::-webkit-slider-thumb {
      -webkit-appearance:none; width:24px; height:24px; border-radius:50%;
      background:var(--brand-color,#1a56db);
      box-shadow:0 2px 8px color-mix(in srgb,var(--brand-color,#1a56db) 40%,transparent);
      cursor:pointer; border:3px solid #fff; transition:transform .15s;
    }
    body.client-mode .client-amount-slider::-webkit-slider-thumb:hover { transform:scale(1.15); }
    body.client-mode .client-amount-display {
      font-size:clamp(28px,6vw,42px); font-weight:800; color:var(--brand-color,#1a56db);
      text-align:center; letter-spacing:-1.5px; margin:8px 0 4px;
    }
    body.client-mode .client-amount-label { font-size:12px; color:#888; text-align:center; text-transform:uppercase; letter-spacing:1px; font-weight:600; margin-bottom:18px; }
    body.client-mode .client-pills-wrap { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:16px; }
    body.client-mode .client-pill {
      flex:1; min-width:52px; padding:10px 6px; border:2px solid #E2E8F0; border-radius:999px;
      background:#fff; font-family:'Sora',sans-serif; font-size:13px; font-weight:700; color:#666;
      cursor:pointer; transition:all .18s; text-align:center;
    }
    body.client-mode .client-pill:hover { border-color:var(--brand-color,#1a56db); color:var(--brand-color,#1a56db); }
    body.client-mode .client-pill.active {
      background:var(--brand-color,#1a56db); border-color:var(--brand-color,#1a56db); color:#fff;
      box-shadow:0 4px 12px color-mix(in srgb,var(--brand-color,#1a56db) 35%,transparent);
    }
    body.client-mode .client-cuota-hero {
      text-align:center; padding:24px 20px;
      background:linear-gradient(135deg,color-mix(in srgb,var(--brand-color,#1a56db) 8%,white),color-mix(in srgb,var(--brand-color,#1a56db) 3%,white));
      border-radius:16px; margin:12px 0 18px;
      border:1.5px solid color-mix(in srgb,var(--brand-color,#1a56db) 15%,transparent);
    }
    body.client-mode .client-cuota-label { font-size:11px; text-transform:uppercase; letter-spacing:1.5px; color:#888; font-weight:700; margin-bottom:4px; }
    body.client-mode .client-cuota-value { font-size:clamp(36px,8vw,54px); font-weight:800; color:var(--brand-color,#1a56db); letter-spacing:-2px; line-height:1; }
    body.client-mode .client-cuota-months { font-size:14px; color:#666; margin-top:6px; font-weight:500; }
    body.client-mode .btn-primary {
      background:var(--brand-color,#1a56db) !important;
      box-shadow:0 6px 20px color-mix(in srgb,var(--brand-color,#1a56db) 40%,transparent);
      border-radius:16px; font-size:15px; padding:15px 20px;
    }
    body.client-mode .btn-primary:hover {
      box-shadow:0 8px 28px color-mix(in srgb,var(--brand-color,#1a56db) 50%,transparent);
      transform:translateY(-2px);
    }
    body.client-mode #btnSendReq { background:var(--brand-color,#1a56db) !important; }
    body.client-mode .breakdown-box { background:#F8FAFC; border:1px solid #E2E8F0; }
    body.client-mode .breakdown-row .bl { color:#666; }
    body.client-mode .breakdown-row .bv { color:#222; }
    body.client-mode .sim-meta { background:#F8FAFC; border-color:#E2E8F0; }
    body.client-mode .sim-meta-item { color:#666; }
    body.client-mode .sim-meta-item strong { color:var(--brand-color,#1a56db); }
    body.client-mode .sim-cuota-value { color:var(--brand-color,#1a56db); font-size:38px; }
    body.client-mode .sim-result-box { background:#F8FAFC; border-color:#E2E8F0; }
    body.client-mode .schedule-wrap { border-color:#E2E8F0; border-radius:16px; }
    body.client-mode .schedule-header { background:#F8FAFC; border-bottom-color:#E2E8F0; }
    body.client-mode .schedule-header span { color:#888; }
    body.client-mode .schedule-row .num { color:#aaa; }
    body.client-mode .schedule-row .date { color:#333; }
    body.client-mode .schedule-row .amount { color:#111; }
    body.client-mode .myloan-status { background:color-mix(in srgb,var(--brand-color,#1a56db) 6%,white); border-color:color-mix(in srgb,var(--brand-color,#1a56db) 25%,transparent); }
    body.client-mode .myloan-name { color:#111; }
    body.client-mode .myloan-meta { color:#666; }
    body.client-mode .progress-bar-fill { background:linear-gradient(90deg,var(--brand-color,#1a56db),color-mix(in srgb,var(--brand-color,#1a56db) 70%,cyan)); }
    #clientAmountManual:focus {
      border-color:var(--brand-color,#1a56db) !important;
      box-shadow:0 0 0 3px color-mix(in srgb,var(--brand-color,#1a56db) 15%,transparent);
      background:#fff !important; outline:none;
    }

    /* LANDING PAGE */
    body.landing-active {
      background:#060b14;
      font-family:'Plus Jakarta Sans','Sora',sans-serif;
    }
    body.landing-active::before {
      background:
        radial-gradient(ellipse 80% 60% at 80% -10%, rgba(14,100,240,.3) 0%, transparent 60%),
        radial-gradient(ellipse 60% 50% at -10% 80%, rgba(110,40,220,.22) 0%, transparent 55%),
        radial-gradient(ellipse 40% 40% at 50% 50%, rgba(0,60,180,.08) 0%, transparent 70%);
    }
    .landing-view { display:none; position:relative; z-index:1; overflow-x:hidden; }
    .landing-view.show { display:block; }
    .grad-text { background:linear-gradient(110deg,#38bdf8 10%,#818cf8 55%,#c084fc 90%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .grad-text2 { background:linear-gradient(110deg,#34d399 10%,#38bdf8 90%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .rv { opacity:1; }
    .landing-view.show .rv { animation:fadeInUp .65s cubic-bezier(.16,1,.3,1) both; }
    .landing-view.show .rv-left { animation:fadeInLeft .65s cubic-bezier(.16,1,.3,1) both; }
    .landing-view.show .rv-right { animation:fadeInRight .65s cubic-bezier(.16,1,.3,1) both; }
    .landing-view.show .rv-scale { animation:fadeInScale .65s cubic-bezier(.16,1,.3,1) both; }
    .rv-d1 { animation-delay:.1s !important; }
    .rv-d2 { animation-delay:.2s !important; }
    .rv-d3 { animation-delay:.3s !important; }
    .rv-d4 { animation-delay:.4s !important; }
    .rv-d5 { animation-delay:.5s !important; }

    .lp-hero {
      position:relative; min-height:100vh;
      display:grid; grid-template-columns:1fr 1fr;
      align-items:center; padding:0 60px; gap:40px; overflow:hidden;
    }
    @media(max-width:960px) { .lp-hero { grid-template-columns:1fr; padding:100px 24px 60px; min-height:auto; text-align:center; } }

    .lp-orb { position:absolute; border-radius:50%; pointer-events:none; filter:blur(100px); animation:glowPulse 4s ease infinite; }
    .lp-orb1 { width:700px; height:700px; right:-200px; top:-200px; background:radial-gradient(circle,rgba(14,100,255,.35) 0%,transparent 65%); }
    .lp-orb2 { width:500px; height:500px; left:-150px; bottom:-100px; background:radial-gradient(circle,rgba(124,58,237,.28) 0%,transparent 65%); }
    .lp-orb3 { width:300px; height:300px; left:40%; top:20%; background:radial-gradient(circle,rgba(56,189,248,.12) 0%,transparent 65%); filter:blur(60px); }

    .lp-grid-lines {
      position:absolute; inset:0; pointer-events:none; z-index:0;
      background-image: linear-gradient(rgba(56,189,248,.04) 1px,transparent 1px), linear-gradient(90deg,rgba(56,189,248,.04) 1px,transparent 1px);
      background-size:60px 60px;
      mask-image:radial-gradient(ellipse 80% 80% at 50% 50%,black 0%,transparent 80%);
    }

    .lp-hero-left { position:relative; z-index:2; padding:120px 0 80px; }
    @media(max-width:960px) { .lp-hero-left { padding:0; } }

    .lp-eyebrow {
      display:inline-flex; align-items:center; gap:8px; padding:7px 16px; border-radius:999px;
      background:rgba(56,189,248,.1); border:1px solid rgba(56,189,248,.25);
      font-size:11px; font-weight:700; color:#38bdf8; letter-spacing:1.5px; text-transform:uppercase; margin-bottom:24px;
    }
    .lp-eyebrow-dot { width:7px; height:7px; border-radius:50%; background:#34d399; animation:dotPulse 2s ease infinite; }

    .lp-title { font-size:clamp(36px,4.5vw,68px); font-weight:900; line-height:1.03; letter-spacing:-2px; color:#fff; margin-bottom:22px; font-family:'Plus Jakarta Sans','Sora',sans-serif; }
    @media(max-width:960px) { .lp-title { font-size:clamp(34px,8vw,52px); } }

    .lp-sub { font-size:17px; color:rgba(255,255,255,.5); line-height:1.8; max-width:460px; margin-bottom:36px; font-weight:400; }
    @media(max-width:960px) { .lp-sub { max-width:100%; font-size:15px; } }

    .lp-cta-row { display:flex; align-items:center; gap:14px; flex-wrap:wrap; }
    @media(max-width:960px) { .lp-cta-row { justify-content:center; } }

    .landing-cta {
      display:inline-flex; align-items:center; gap:10px; padding:16px 32px;
      background:linear-gradient(135deg,#1d4ed8,#7c3aed); border:none; border-radius:14px; color:#fff;
      font-family:'Plus Jakarta Sans','Sora',sans-serif; font-size:15px; font-weight:700; cursor:pointer;
      box-shadow:0 12px 40px rgba(109,40,217,.5), 0 0 0 1px rgba(167,139,250,.25);
      transition:transform .18s, box-shadow .18s; text-decoration:none; white-space:nowrap;
      position:relative; overflow:hidden;
    }
    .landing-cta::before { content:''; position:absolute; inset:0; background:linear-gradient(135deg,rgba(255,255,255,.15),transparent); opacity:0; transition:opacity .18s; }
    .landing-cta:hover { transform:translateY(-3px); box-shadow:0 20px 50px rgba(109,40,217,.65), 0 0 0 1px rgba(196,181,253,.35); }
    .landing-cta:hover::before { opacity:1; }
    .landing-cta svg { width:17px; height:17px; stroke:currentColor; fill:none; stroke-width:2.5; flex-shrink:0; }

    .lp-secondary-cta {
      display:inline-flex; align-items:center; gap:8px; padding:15px 26px; border-radius:14px;
      border:1.5px solid rgba(255,255,255,.15); background:rgba(255,255,255,.05);
      color:rgba(255,255,255,.8); font-family:'Plus Jakarta Sans','Sora',sans-serif;
      font-size:14px; font-weight:600; cursor:pointer; transition:all .18s; backdrop-filter:blur(12px);
    }
    .lp-secondary-cta:hover { border-color:rgba(255,255,255,.3); background:rgba(255,255,255,.09); color:#fff; transform:translateY(-2px); }

    .landing-demo { font-size:13px; color:rgba(255,255,255,.35); margin-top:18px; }
    .landing-demo a { color:#38bdf8; text-decoration:none; font-weight:700; }
    .landing-demo a:hover { text-decoration:underline; }
    @media(max-width:960px) { .landing-demo { text-align:center; } }

    .lp-social-proof { display:flex; align-items:center; gap:12px; margin-top:28px; }
    @media(max-width:960px) { .lp-social-proof { justify-content:center; } }
    .lp-avatars { display:flex; }
    .lp-avatar-img { width:40px; height:40px; border-radius:50%; border:2px solid rgba(255,255,255,.25); object-fit: cover; margin-left: -8px; }
    .lp-avatar-img:first-child { margin-left: 0; }
    .lp-proof-text { font-size:12px; color:rgba(255,255,255,.45); line-height:1.5; }
    .lp-proof-text strong { color:#34d399; font-weight:700; }
    .lp-stars { color:#fbbf24; font-size:11px; letter-spacing:1px; }

    .lp-hero-right {
      position:relative; z-index:2;
      display:flex; align-items:center; justify-content:center;
      padding:120px 0 80px; height:100%;
    }
    @media(max-width:960px) { .lp-hero-right { padding:0; display:none; } }

    .lp-person-wrap { position:relative; width:420px; height:500px; display:flex; align-items:flex-end; justify-content:center; }
    .lp-person-circle {
      position:absolute; bottom:0; left:50%; transform:translateX(-50%);
      width:380px; height:380px; border-radius:50%;
      background:radial-gradient(circle,rgba(30,80,220,.45) 0%,rgba(100,40,200,.2) 50%,transparent 75%);
      border:1px solid rgba(56,189,248,.15);
    }
    .lp-person-circle::before {
      content:''; position:absolute; inset:-20px; border-radius:50%;
      border:1px dashed rgba(56,189,248,.15);
      animation:spin-slow 20s linear infinite;
    }
    .lp-person-img {
      position:relative; z-index:2; width:330px; height:450px;
      object-fit:cover; object-position:top center; border-radius:24px;
      filter:drop-shadow(0 40px 80px rgba(0,0,0,.6));
    }

    .lp-fbadge {
      position:absolute; z-index:10; display:flex; align-items:center; gap:10px;
      padding:10px 16px; background:rgba(10,18,35,.85);
      border:1px solid rgba(255,255,255,.14); border-radius:14px;
      backdrop-filter:blur(16px); white-space:nowrap; box-shadow:0 20px 50px rgba(0,0,0,.5);
    }
    .lp-fbadge.fb-approved { top:80px; right:-30px; animation:floatBadge 3.5s ease-in-out infinite; }
    .lp-fbadge.fb-new { bottom:100px; left:-40px; animation:floatBadge 3s ease-in-out infinite reverse; }
    .lp-fbadge.fb-amount { top:220px; right:-50px; animation:floatBadge 4s ease-in-out infinite .5s; }
    .lp-fbadge-icon { width:32px; height:32px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:16px; flex-shrink:0; }
    .lp-fbadge-icon.green { background:rgba(52,211,153,.2); }
    .lp-fbadge-icon.blue { background:rgba(56,189,248,.2); }
    .lp-fbadge-icon.purple { background:rgba(167,139,250,.2); }
    .lp-fbadge-title { font-size:12px; font-weight:700; color:#fff; display:block; }
    .lp-fbadge-sub { font-size:10px; color:rgba(255,255,255,.45); display:block; margin-top:1px; }
    .lp-fbadge-dot { width:7px; height:7px; border-radius:50%; flex-shrink:0; }
    .lp-fbadge-dot.green { background:#34d399; box-shadow:0 0 10px #34d399; animation:dotPulse 2s infinite; }
    .lp-fbadge-dot.blue { background:#38bdf8; box-shadow:0 0 10px #38bdf8; animation:dotPulse 2.3s infinite; }
    @media(max-width:960px) { .lp-fbadge.fb-approved { right:-10px; } .lp-fbadge.fb-new { left:-10px; } }

    .lp-proof-strip {
      border-top:1px solid rgba(255,255,255,.06); border-bottom:1px solid rgba(255,255,255,.06);
      padding:18px 60px; background:rgba(255,255,255,.025); backdrop-filter:blur(8px);
    }
    @media(max-width:700px) { .lp-proof-strip { padding:16px 20px; } }
    .lp-proof-inner {
      max-width:1260px; margin:0 auto;
      display:flex; align-items:center; justify-content:center; gap:32px; flex-wrap:wrap;
    }
    .lp-proof-item { display:flex; align-items:center; gap:8px; font-size:13px; font-weight:600; color:rgba(255,255,255,.5); }
    .lp-proof-item svg { width:14px; height:14px; stroke:#38bdf8; fill:none; stroke-width:2.5; flex-shrink:0; }
    .lp-proof-sep { width:1px; height:18px; background:rgba(255,255,255,.1); }
    @media(max-width:700px) { .lp-proof-sep { display:none; } }

    .lp-section { max-width:1260px; margin:0 auto; padding:90px 60px; }
    @media(max-width:700px) { .lp-section { padding:64px 24px; } }
    .lp-s-label {
      display:inline-flex; align-items:center; gap:6px;
      font-size:11px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase;
      color:#38bdf8; margin-bottom:14px;
    }
    .lp-s-title { font-size:clamp(28px,3.5vw,48px); font-weight:800; color:#fff; letter-spacing:-1.5px; line-height:1.1; margin-bottom:18px; font-family:'Plus Jakarta Sans','Sora',sans-serif; }
    .lp-s-sub { font-size:16px; color:rgba(255,255,255,.45); line-height:1.75; max-width:520px; }

    .lp-feat-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:18px; margin-top:52px; }
    @media(max-width:900px) { .lp-feat-grid { grid-template-columns:1fr 1fr; } }
    @media(max-width:600px) { .lp-feat-grid { grid-template-columns:1fr; } }
    .lp-feat-card {
      background:rgba(255,255,255,.035); border:1px solid rgba(255,255,255,.08);
      border-radius:20px; padding:28px; backdrop-filter:blur(10px);
      transition:border-color .25s, transform .25s, background .25s;
      position:relative; overflow:hidden;
    }
    .lp-feat-card::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,rgba(56,189,248,.5),transparent); opacity:0; transition:opacity .25s; }
    .lp-feat-card:hover { border-color:rgba(56,189,248,.25); transform:translateY(-4px); background:rgba(255,255,255,.055); }
    .lp-feat-card:hover::before { opacity:1; }
    .lp-feat-icon { width:52px; height:52px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:24px; margin-bottom:18px; background:linear-gradient(135deg,rgba(30,80,220,.3),rgba(100,40,200,.2)); border:1px solid rgba(56,189,248,.15); }
    .lp-feat-title { font-size:16px; font-weight:700; color:#fff; margin-bottom:8px; letter-spacing:-.3px; }
    .lp-feat-desc { font-size:13px; color:rgba(255,255,255,.5); line-height:1.7; }

    .lp-bento { max-width:1260px; margin:0 auto; padding:0 60px 90px; display:grid; grid-template-columns:1fr 1fr; gap:60px; align-items:center; }
    @media(max-width:900px) { .lp-bento { grid-template-columns:1fr; padding:0 24px 64px; gap:40px; } }
    .lp-bento-text { padding:20px 0; }
    .lp-bento-check { display:flex; align-items:flex-start; gap:12px; margin-bottom:16px; font-size:14px; color:rgba(255,255,255,.7); font-weight:500; }
    .lp-bento-check-icon { width:24px; height:24px; border-radius:8px; background:rgba(52,211,153,.2); border:1px solid rgba(52,211,153,.35); display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:1px; }
    .lp-bento-check-icon svg { width:13px; height:13px; stroke:#34d399; fill:none; stroke-width:2.5; }

    .lp-bento-img-wrap {
      border-radius:20px; overflow:hidden;
      box-shadow:0 40px 100px rgba(0,0,0,.6), 0 0 0 1px rgba(56,189,248,.1);
      background:rgba(8,16,32,.9);
    }
    .lp-bento-screenshot { display:block; width:100%; height:auto; object-fit:cover; }

    .lp-trust-section { max-width:1260px; margin:0 auto; padding:0 60px 90px; }
    @media(max-width:700px) { .lp-trust-section { padding:0 24px 64px; } }
    .lp-trust-inner {
      display:grid; grid-template-columns:1fr 1fr; gap:60px; align-items:center;
      background:rgba(255,255,255,.025); border:1px solid rgba(255,255,255,.07);
      border-radius:28px; padding:60px; position:relative; overflow:hidden;
    }
    @media(max-width:900px) { .lp-trust-inner { grid-template-columns:1fr; padding:40px 24px; gap:36px; } }
    .lp-trust-inner::before { content:''; position:absolute; top:-80px; right:-80px; width:400px; height:400px; border-radius:50%; background:radial-gradient(circle,rgba(56,189,248,.08) 0%,transparent 65%); pointer-events:none; }
    .lp-trust-text .lp-s-sub { margin-bottom:28px; }
    .lp-trust-img-wrap { position:relative; display:flex; align-items:center; justify-content:center; }
    .lp-trust-img {
      width:100%; max-width:480px; height:auto;
      border-radius:20px; object-fit:cover;
      box-shadow:0 30px 80px rgba(0,0,0,.5);
    }
    .lp-trust-badge {
      position:absolute; display:flex; align-items:center; gap:10px;
      padding:12px 18px; background:rgba(8,16,32,.9); border:1px solid rgba(255,255,255,.15);
      border-radius:14px; backdrop-filter:blur(16px); font-size:13px; color:#fff; font-weight:700;
      box-shadow:0 16px 40px rgba(0,0,0,.4); white-space:nowrap;
    }
    .lp-trust-badge strong { color:#34d399; }
    .lp-trust-badge-a { bottom:20px; left:-20px; animation:floatBadge 3.5s ease-in-out infinite; }
    .lp-trust-badge-b { top:20px; right:-20px; animation:floatBadge 3s ease-in-out infinite reverse; }
    @media(max-width:900px) { .lp-trust-badge-a { left:10px; } .lp-trust-badge-b { right:10px; } }

    .lp-test-section { max-width:1260px; margin:0 auto; padding:0 60px 90px; }
    @media(max-width:700px) { .lp-test-section { padding:0 24px 64px; } }
    .lp-test-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:18px; }
    @media(max-width:900px) { .lp-test-grid { grid-template-columns:1fr; } }
    .lp-test-card {
      background:rgba(255,255,255,.035); border:1px solid rgba(255,255,255,.08);
      border-radius:20px; padding:26px; backdrop-filter:blur(10px);
      transition:border-color .25s, transform .25s;
    }
    .lp-test-card:hover { border-color:rgba(56,189,248,.2); transform:translateY(-4px); }
    .lp-test-header { display:flex; align-items:center; gap:14px; margin-bottom:16px; }
    .lp-test-avatar-wrap { position:relative; flex-shrink:0; }
    .lp-test-avatar { width:48px; height:48px; border-radius:14px; object-fit:cover; border:2px solid rgba(56,189,248,.2); }
    .lp-test-avatar-emoji { width:48px; height:48px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:22px; background:linear-gradient(135deg,rgba(30,80,220,.3),rgba(100,40,200,.2)); border:1px solid rgba(255,255,255,.1); }
    .lp-test-info { flex:1; }
    .lp-test-name { font-size:14px; font-weight:700; color:#fff; margin-bottom:2px; }
    .lp-test-role { font-size:11px; color:rgba(255,255,255,.35); }
    .lp-test-stars { display:flex; gap:2px; margin-bottom:14px; }
    .lp-test-stars span { color:#fbbf24; font-size:13px; }
    .lp-test-quote { font-size:13px; color:rgba(255,255,255,.6); line-height:1.75; font-style:italic; }

    .lp-stats-row { max-width:1260px; margin:0 auto; padding:0 60px 90px; }
    @media(max-width:700px) { .lp-stats-row { padding:0 24px 64px; } }
    .lp-stats-inner { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; }
    @media(max-width:700px) { .lp-stats-inner { grid-template-columns:1fr 1fr; } }
    .lp-stat-box { background:rgba(255,255,255,.035); border:1px solid rgba(255,255,255,.07); border-radius:20px; padding:28px 20px; text-align:center; backdrop-filter:blur(10px); transition:border-color .25s, transform .25s; }
    .lp-stat-box:hover { border-color:rgba(56,189,248,.2); transform:translateY(-3px); }
    .lp-stat-num { font-family:'Plus Jakarta Sans','DM Mono',monospace; font-size:40px; font-weight:900; letter-spacing:-2px; line-height:1; background:linear-gradient(110deg,#38bdf8,#818cf8); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .lp-stat-label { font-size:11px; color:rgba(255,255,255,.4); text-transform:uppercase; letter-spacing:1.2px; font-weight:600; margin-top:10px; }

    .lp-final-section { max-width:1260px; margin:0 auto; padding:0 60px 120px; }
    @media(max-width:700px) { .lp-final-section { padding:0 24px 80px; } }
    .lp-final-inner {
      position:relative; text-align:center;
      background:linear-gradient(135deg,rgba(20,80,220,.2),rgba(109,40,217,.15));
      border:1px solid rgba(56,189,248,.15); border-radius:28px; padding:80px 48px; overflow:hidden;
    }
    .lp-final-inner::before { content:''; position:absolute; top:-100px; left:50%; transform:translateX(-50%); width:600px; height:600px; border-radius:50%; background:radial-gradient(circle,rgba(14,100,240,.2) 0%,transparent 60%); pointer-events:none; }
    .lp-final-inner h2 { position:relative; font-size:clamp(28px,4vw,54px); font-weight:900; color:#fff; letter-spacing:-2px; line-height:1.05; margin-bottom:18px; font-family:'Plus Jakarta Sans','Sora',sans-serif; }
    .lp-final-inner p { position:relative; font-size:17px; color:rgba(255,255,255,.5); line-height:1.75; max-width:500px; margin:0 auto 44px; }
    @media(max-width:600px) { .lp-final-inner { padding:48px 24px; } }

    @media(max-width:1100px) { .dashboard-grid { grid-template-columns:repeat(3,1fr); } }
    @media(max-width:1000px) { .mora-row { grid-template-columns:1fr auto auto; } }
    @media(max-width:900px) {
      .client-grid { grid-template-columns:1fr; }
      .hero-section { grid-template-columns:1fr; }
      .hero-kpis { grid-template-columns:1fr 1fr; }
      .topbar-inner, .hero-section, .main-wrap { padding-left:16px; padding-right:16px; }
      .dashboard-grid { grid-template-columns:repeat(2,1fr); }
      .sa-metrics { grid-template-columns:1fr 1fr; }
      .sa-row { grid-template-columns:1fr auto; }
    }
    @media(max-width:768px) { .sa-metrics { grid-template-columns:1fr 1fr; } }
    @media(max-width:700px) {
      .mora-row { grid-template-columns:1fr auto; }
      .mora-summary { grid-template-columns:1fr 1fr; }
    }
    @media(max-width:600px) {
      .input-row, .input-row3 { grid-template-columns:1fr; }
      .nav-btn .nav-label { display:none; }
      .schedule-header, .schedule-row { grid-template-columns:30px 1fr 90px auto; gap:4px; padding:10px; }
      .dashboard-grid { grid-template-columns:1fr 1fr; gap:10px; }
      .mora-row { grid-template-columns:1fr auto; }
      .plazo-grid { grid-template-columns:repeat(6,1fr); }
      .lp-trust-inner { padding:32px 16px; }
    }

    /* Estilos críticos adicionales */
    body.landing-active #landingView { display: block; }
    #landingView { display: none; }
    #onboardingOverlay, #adminGate, #moniView, #superadminView, #adminView, #clientView { display: none; }
  </style>
</head>
<body>

<!-- ============================================
     SCRIPT DE INICIALIZACIÓN
     ============================================ -->
<script>
(function() {
  const params = new URLSearchParams(location.search);
  const hasRef = params.get('ref');
  
  if (!hasRef) {
    document.body.classList.add('landing-active');
    document.getElementById('landingView').style.display = 'block';
  }
  
  window.SUPERADMIN_UID = 'cuQqbuHWkTWdFPdknVTUAkx5Xri2';
  window.SUPERADMIN_EMAIL = 'fernandogastondelgado81@gmail.com';
  
  setTimeout(function() {
    const btnsRegister = ['btnLandingRegister', 'btnLandingRegister2', 'btnLandingRegister3'];
    btnsRegister.forEach(function(id) {
      const btn = document.getElementById(id);
      if (btn) {
        btn.onclick = function(e) {
          e.preventDefault();
          document.getElementById('landingView').style.display = 'none';
          document.getElementById('onboardingOverlay').style.display = 'flex';
          return false;
        };
      }
    });
    
    const loginBtn = document.getElementById('btnLandingLogin');
    if (loginBtn) {
      loginBtn.onclick = function(e) {
        e.preventDefault();
        document.getElementById('landingView').style.display = 'none';
        document.getElementById('adminGate').style.display = 'block';
        return false;
      };
    }
    
    const goToRegister = document.getElementById('btnGoToRegister');
    if (goToRegister) {
      goToRegister.onclick = function(e) {
        e.preventDefault();
        document.getElementById('adminGate').style.display = 'none';
        document.getElementById('landingView').style.display = 'block';
        return false;
      };
    }
  }, 100);
})();
</script>

<!-- ============================================
     LANDING PAGE - COMPLETA
     ============================================ -->
<div class="landing-view" id="landingView">
  <section class="lp-hero">
    <div class="lp-orb lp-orb1"></div>
    <div class="lp-orb lp-orb2"></div>
    <div class="lp-orb lp-orb3"></div>
    <div class="lp-grid-lines"></div>

    <div class="lp-hero-left">
      <div class="lp-eyebrow rv">
        <span class="lp-eyebrow-dot"></span>
        Para prestamistas independientes
      </div>

      <h1 class="lp-title rv rv-d1">
        Tu Financiera<br>
        <span class="grad-text">Digital,</span><br>
        Lista en <span class="grad-text">Minutos</span>
      </h1>

      <p class="lp-sub rv rv-d2">
        Gestión. Cobros. Crecimiento. Ilimitado.<br>
        La plataforma que digitaliza tu actividad de préstamos sin código, sin papeles, desde hoy.
      </p>

      <div class="lp-cta-row rv rv-d3">
        <button class="landing-cta" id="btnLandingRegister">
          <svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
          Creá tu propia financiera
        </button>
      </div>

      <div class="lp-social-proof rv rv-d4">
        <div class="lp-avatars">
          <img src="assets/avatar1.jpg" alt="Prestamista" class="lp-avatar-img" onerror="this.src='https://randomuser.me/api/portraits/women/44.jpg'">
          <img src="assets/avatar2.jpg" alt="Prestamista" class="lp-avatar-img" onerror="this.src='https://randomuser.me/api/portraits/men/32.jpg'">
          <img src="assets/avatar3.jpg" alt="Prestamista" class="lp-avatar-img" onerror="this.src='https://randomuser.me/api/portraits/women/68.jpg'">
          <img src="assets/avatar4.jpg" alt="Prestamista" class="lp-avatar-img" onerror="this.src='https://randomuser.me/api/portraits/men/75.jpg'">
        </div>
        <div>
          <div class="lp-stars">★★★★★</div>
          <div class="lp-proof-text"><strong>+200 prestamistas</strong> ya digitalizaron su negocio</div>
        </div>
      </div>

      <div class="landing-demo rv rv-d5">
        ¿Ya tenés cuenta? <a href="#" id="btnLandingLogin">Iniciá sesión acá</a>
      </div>
    </div>

    <div class="lp-hero-right rv rv-right rv-d2">
      <div class="lp-person-wrap">
        <div class="lp-person-circle"></div>
        <img class="lp-person-img" src="assets/1772058267760.png" alt="App Móvil" loading="eager" onerror="this.style.display='none'">
        <div class="lp-fbadge fb-approved">
          <div class="lp-fbadge-icon green">✅</div>
          <div><span class="lp-fbadge-title">Solicitud Aprobada</span><span class="lp-fbadge-sub">hace 2 min · $150.000</span></div>
          <span class="lp-fbadge-dot green"></span>
        </div>
        <div class="lp-fbadge fb-new">
          <div class="lp-fbadge-icon blue">🔔</div>
          <div><span class="lp-fbadge-title">Nueva solicitud</span><span class="lp-fbadge-sub">Carlos R. · $300.000</span></div>
          <span class="lp-fbadge-dot blue"></span>
        </div>
        <div class="lp-fbadge fb-amount">
          <div class="lp-fbadge-icon purple">💰</div>
          <div><span class="lp-fbadge-title">Cobro recibido</span><span class="lp-fbadge-sub">Cuota 3/6 · $32.450</span></div>
        </div>
      </div>
    </div>
  </section>

  <div class="lp-proof-strip rv">
    <div class="lp-proof-inner">
      <div class="lp-proof-item"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg><span>100% Digital</span></div>
      <div class="lp-proof-sep"></div>
      <div class="lp-proof-item"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Datos protegidos</span></div>
      <div class="lp-proof-sep"></div>
      <div class="lp-proof-item"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span>Setup en <strong style="color:#fff">3 minutos</strong></span></div>
      <div class="lp-proof-sep"></div>
      <div class="lp-proof-item"><svg viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg><span>Firma Ley 25.506</span></div>
      <div class="lp-proof-sep"></div>
      <div class="lp-proof-item"><svg viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg><span>Soporte WhatsApp</span></div>
    </div>
  </div>

  <section class="lp-section" id="lpFeatures">
    <div style="text-align:center">
      <span class="lp-s-label rv">✦ Todo lo que necesitás</span>
      <h2 class="lp-s-title rv rv-d1">Tu Financiera en <span class="grad-text">Minutos</span></h2>
      <p class="lp-s-sub rv rv-d2" style="margin:0 auto">Desde el simulador hasta el cobro, todo integrado. Sin planillas ni aplicaciones separadas.</p>
    </div>
    <div class="lp-feat-grid">
      <div class="lp-feat-card rv rv-d1"><div class="lp-feat-icon">🏦</div><div class="lp-feat-title">Tu Marca Blanca</div><div class="lp-feat-desc">Personalizá con tu nombre, logo y colores. Tus clientes ven tu financiera, no Prestify. Identidad 100% tuya.</div></div>
      <div class="lp-feat-card rv rv-d2"><div class="lp-feat-icon">📱</div><div class="lp-feat-title">Link de Cliente Único</div><div class="lp-feat-desc">Compartí un link. Tus clientes simulan, solicitan y firman desde el celu.</div></div>
      <div class="lp-feat-card rv rv-d3"><div class="lp-feat-icon">⚡</div><div class="lp-feat-title">Panel en Tiempo Real</div><div class="lp-feat-desc">Recibí solicitudes al instante. Aprobás desde tu celu en segundos.</div></div>
      <div class="lp-feat-card rv rv-d2"><div class="lp-feat-icon">📊</div><div class="lp-feat-title">Motor Financiero</div><div class="lp-feat-desc">Sistema francés, TNA configurable y gestión de mora automática.</div></div>
      <div class="lp-feat-card rv rv-d3"><div class="lp-feat-icon">💳</div><div class="lp-feat-title">Cobro Online</div><div class="lp-feat-desc">Mercado Pago o transferencia manual. El sistema registra todo solo.</div></div>
      <div class="lp-feat-card rv rv-d4"><div class="lp-feat-icon">📝</div><div class="lp-feat-title">Contratos Digitales</div><div class="lp-feat-desc">Firma electrónica válida (Ley 25.506). Cero papeles.</div></div>
    </div>
  </section>

  <div class="lp-bento">
    <div class="lp-bento-text rv rv-left">
      <span class="lp-s-label">✦ Panel de administración</span>
      <h2 class="lp-s-title">Ponele fin a las<br><span class="grad-text">planillas de Excel</span></h2>
      <p class="lp-s-sub" style="margin-bottom:28px">Un dashboard limpio que te da el control total de tu cartera en tiempo real.</p>
      <div class="lp-bento-check"><div class="lp-bento-check-icon"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><span>KPIs de cartera actualizados en tiempo real</span></div>
      <div class="lp-bento-check"><div class="lp-bento-check-icon"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><span>Notificaciones push de nuevas solicitudes</span></div>
      <div class="lp-bento-check"><div class="lp-bento-check-icon"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><span>Gestión de mora y cobranza automatizada</span></div>
      <div class="lp-bento-check"><div class="lp-bento-check-icon"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><span>Acceso desde cualquier dispositivo, 24/7</span></div>
    </div>
    <div class="rv rv-right rv-d1">
      <div class="lp-bento-img-wrap">
        <img src="assets/1772058249023.png" alt="Dashboard" class="lp-bento-screenshot" loading="lazy" onerror="this.style.display='none'">
      </div>
    </div>
  </div>

  <section class="lp-trust-section">
    <div class="lp-trust-inner rv">
      <div class="lp-trust-text">
        <span class="lp-s-label">✦ Confianza y respaldo</span>
        <h2 class="lp-s-title">La plataforma en la que<br><span class="grad-text2">confían los mejores</span></h2>
        <p class="lp-s-sub">Más de 200 prestamistas independientes en toda Argentina usan Prestify.</p>
        <button class="landing-cta" id="btnLandingRegister3" style="margin-top:8px"><svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>Sumate ahora — Es gratis</button>
      </div>
      <div class="lp-trust-img-wrap rv rv-right rv-d2">
        <img src="assets/1772058471896.png" alt="Confianza" class="lp-trust-img" loading="lazy" onerror="this.style.display='none'">
        <div class="lp-trust-badge lp-trust-badge-a"><span>🌎</span><div><strong>+200</strong> prestamistas activos</div></div>
        <div class="lp-trust-badge lp-trust-badge-b"><span>⭐</span><div><strong>4.9/5</strong> satisfacción</div></div>
      </div>
    </div>
  </section>

  <section class="lp-test-section">
    <div style="text-align:center;margin-bottom:44px">
      <span class="lp-s-label rv">✦ Testimoniales</span>
      <h2 class="lp-s-title rv rv-d1">Prestamistas que ya<br><span class="grad-text">digitalizaron</span> su negocio</h2>
    </div>
    <div class="lp-test-grid">
      <div class="lp-test-card rv rv-d1"><div class="lp-test-header"><div class="lp-test-avatar-wrap"><div class="lp-test-avatar-initial c1">R</div></div><div class="lp-test-info"><div class="lp-test-name">Roberto M.</div><div class="lp-test-role">Córdoba</div></div></div><div class="lp-test-stars">★★★★★</div><div class="lp-test-quote">"Antes llevaba todo en Excel. Ahora mis clientes entran al link, simulan y me mandan la solicitud."</div></div>
      <div class="lp-test-card rv rv-d2"><div class="lp-test-header"><div class="lp-test-avatar-wrap"><div class="lp-test-avatar-initial c2">V</div></div><div class="lp-test-info"><div class="lp-test-name">Valeria S.</div><div class="lp-test-role">Buenos Aires</div></div></div><div class="lp-test-stars">★★★★★</div><div class="lp-test-quote">"El panel me avisa cuando vence una cuota. Redujo mi mora a casi cero."</div></div>
      <div class="lp-test-card rv rv-d3"><div class="lp-test-header"><div class="lp-test-avatar-wrap"><div class="lp-test-avatar-initial c3">J</div></div><div class="lp-test-info"><div class="lp-test-name">Juan P.</div><div class="lp-test-role">Rosario</div></div></div><div class="lp-test-stars">★★★★★</div><div class="lp-test-quote">"Mis clientes ven 'Préstamos Martínez', nunca supieron que uso Prestify."</div></div>
    </div>
  </section>

  <section class="lp-stats-row">
    <div class="lp-stats-inner">
      <div class="lp-stat-box rv rv-d1"><div class="lp-stat-num">100%</div><div class="lp-stat-label">Digital</div></div>
      <div class="lp-stat-box rv rv-d2"><div class="lp-stat-num">3min</div><div class="lp-stat-label">Setup inicial</div></div>
      <div class="lp-stat-box rv rv-d3"><div class="lp-stat-num">0</div><div class="lp-stat-label">Código</div></div>
      <div class="lp-stat-box rv rv-d4"><div class="lp-stat-num">∞</div><div class="lp-stat-label">Clientes</div></div>
    </div>
  </section>

  <section class="lp-final-section">
    <div class="lp-final-inner rv">
      <h2>¿Listo para digitalizar<br>tu <span class="grad-text">financiera</span>?</h2>
      <p>Registrate gratis y empezá a gestionar tu actividad de préstamos de forma 100% profesional.</p>
      <button class="landing-cta" id="btnLandingRegister2" style="display:inline-flex;margin:0 auto"><svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>Creá tu cuenta ahora — Es gratis</button>
    </div>
  </section>
</div>

<!-- ============================================
     LOGIN GATE
     ============================================ -->
<div class="admin-gate" id="adminGate" style="display: none; max-width: 400px; margin: 40px auto; padding: 30px; background: var(--navy-card); border: 1px solid var(--border-hi); border-radius: 20px;">
  <div style="text-align: center; margin-bottom: 20px;">
    <div style="width: 60px; height: 60px; border-radius: 16px; background: linear-gradient(135deg, var(--blue), var(--sky)); display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
      <svg viewBox="0 0 24 24" width="30" height="30" stroke="white" fill="none" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
    </div>
    <h3 style="color: var(--white); margin-bottom: 8px;">Iniciar sesión</h3>
    <p style="color: var(--muted); font-size: 13px;">Ingresá tus credenciales de prestamista</p>
  </div>
  
  <input type="email" id="loginEmail" placeholder="Email" value="fernandogastondelgado81@gmail.com" style="width: 100%; padding: 14px 16px; margin-bottom: 12px; background: #071428; border: 1px solid var(--border); border-radius: 12px; color: var(--white); font-size: 15px;">
  <input type="password" id="loginPass" placeholder="Contraseña" style="width: 100%; padding: 14px 16px; margin-bottom: 20px; background: #071428; border: 1px solid var(--border); border-radius: 12px; color: var(--white); font-size: 15px;">
  
  <button id="btnAdminLogin" class="btn-primary" style="width: 100%; padding: 14px; margin-bottom: 12px;">Ingresar como prestamista</button>
  
  <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center;">
    <p style="color: var(--muted); font-size: 12px;">¿Sos SuperAdmin? <a href="#" id="btnSuperAdminLogin" style="color: var(--sky); font-weight: 600; text-decoration: none;">Acceso especial</a></p>
  </div>
  
  <div style="margin-top: 15px; text-align: center;">
    <a href="#" id="btnForgotPass" style="color: var(--sky); font-size: 12px; text-decoration: none;">¿Olvidaste tu contraseña?</a>
  </div>
  
  <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center;">
    <p style="color: var(--muted); font-size: 12px;">¿No tenés cuenta? <a href="#" id="btnGoToRegister" style="color: var(--sky); font-weight: 600; text-decoration: none;">Registrate</a></p>
  </div>
</div>

<!-- ============================================
     VISTA MONI (PORTAL CLIENTE)
     ============================================ -->
<div id="moniView">
  <div class="moni-topbar">
    <div class="moni-logo">
      <div class="moni-logo-circle" id="moniLogoCircle">M</div>
      <span class="moni-logo-name" id="moniLogoName">Mi <span>Financiera</span></span>
    </div>
    <div style="font-size:12px;color:#64748b;font-weight:600" id="moniTagline">Préstamos rápidos y seguros</div>
  </div>

  <div class="moni-hero">
    <div class="moni-hero-pill"><span>✅</span> 100% seguro y digital</div>
    <h1 class="moni-hero-title">Conseguí tu préstamo<br>en <span>minutos</span></h1>
    <p class="moni-hero-sub">Simulá el monto que necesitás, completá tus datos y enviá tu solicitud. Rápido, fácil y sin papeles.</p>
    <div class="moni-steps-row">
      <div class="moni-step-pill"><span class="moni-step-icon">🧮</span> Simulá</div>
      <div class="moni-step-pill"><span class="moni-step-icon">📝</span> Solicitá</div>
      <div class="moni-step-pill"><span class="moni-step-icon">💸</span> Recibí</div>
    </div>
  </div>

  <div class="moni-main">
    <div class="moni-card" id="moniSimCard">
      <div class="moni-card-title"><div class="moni-card-title-icon">🧮</div>Simulá tu préstamo</div>
      <div style="text-align:center;font-size:12px;color:#94a3b8;font-weight:600;text-transform:uppercase;letter-spacing:.8px;margin-bottom:4px">¿Cuánto necesitás?</div>
      <div class="moni-amount-display" id="moniAmountDisplay">$ 50.000</div>
      <input type="range" class="moni-slider" id="moniSlider" min="5000" max="1000000" step="5000" value="50000" oninput="window.moniUpdateSlider(this)">
      <div class="moni-slider-labels"><span id="moniSliderMin">$ 5.000</span><span id="moniSliderMax">$ 1.000.000</span></div>

      <div style="font-size:13px;font-weight:600;color:#334155;margin-bottom:10px">Elegí el plazo</div>
      <div class="moni-pill-row" id="moniPillRow"></div>

      <button class="moni-btn-primary" onclick="window.moniSimular()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Calcular cuotas</button>

      <div id="moniSimResult" style="margin-top:18px">
        <div class="moni-result-table">
          <div class="moni-result-row"><span class="lbl">Monto solicitado</span><span class="val" id="moniResCapital">$ —</span></div>
          <div class="moni-result-row"><span class="lbl">Plazo</span><span class="val" id="moniResPlazo">— meses</span></div>
          <div class="moni-result-row"><span class="lbl">TNA</span><span class="val" id="moniResTna">—%</span></div>
          <div class="moni-result-row highlight"><span class="lbl" style="font-weight:700;color:#0f172a">Cuota mensual</span><span class="val" id="moniResCuota">$ —</span></div>
          <div class="moni-result-row"><span class="lbl">Total a pagar</span><span class="val" id="moniResTotal">$ —</span></div>
        </div>
        <button class="moni-btn-primary" onclick="window.moniShowForm()" id="moniBtnSolicitar"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>Solicitar este préstamo</button>
      </div>
    </div>

    <div class="moni-card" id="moniFormSection">
      <div class="moni-card-title"><div class="moni-card-title-icon">📝</div>Tus datos personales</div>
      <label class="moni-input-label">Nombre y apellido</label><input class="moni-input" id="moniName" placeholder="Juan Pérez">
      <label class="moni-input-label">DNI</label><input class="moni-input" id="moniDni" inputmode="numeric" placeholder="30123456">
      <label class="moni-input-label">Email</label><input class="moni-input" id="moniEmail" type="email" placeholder="correo@mail.com">
      <label class="moni-input-label">Teléfono (WhatsApp)</label><input class="moni-input" id="moniPhone" inputmode="tel" placeholder="2966 123456">
      <label class="moni-input-label">Alias o CBU / CVU</label><input class="moni-input" id="moniAlias" placeholder="alias.banco o 22 dígitos">
      <div style="background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.18);border-radius:12px;padding:12px 14px;margin-bottom:16px;font-size:12px;color:#374151;line-height:1.6">🔒 Tus datos están protegidos bajo la Ley 25.326 de Protección de Datos Personales.</div>
      <button class="moni-btn-primary" onclick="window.moniEnviarSolicitud()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>Enviar solicitud</button>
      <button onclick="document.getElementById('moniFormSection').style.display='none';document.getElementById('moniSimResult').style.display='block'" style="width:100%;margin-top:10px;background:none;border:1.5px solid #e2e8f0;border-radius:14px;padding:11px;font-family:inherit;font-size:13px;font-weight:600;color:#64748b;cursor:pointer">← Volver al simulador</button>
    </div>

    <div class="moni-card" id="moniSuccessSection" style="text-align:center">
      <div style="font-size:56px;margin-bottom:12px">🎉</div>
      <div style="font-size:20px;font-weight:800;color:#0f172a;margin-bottom:8px">¡Solicitud enviada!</div>
      <div style="font-size:14px;color:#64748b;line-height:1.65;margin-bottom:24px">Tu solicitud fue recibida con éxito. En breve <strong id="moniLenderContactName">tu financiera</strong> se pondrá en contacto.</div>
      <div class="moni-result-table"><div class="moni-result-row"><span class="lbl">Monto</span><span class="val" id="moniSucCapital">—</span></div><div class="moni-result-row highlight"><span class="lbl">Cuota</span><span class="val" id="moniSucCuota">—</span></div></div>
      <div id="moniWaContact" style="display:none;margin-top:16px"><a id="moniWaLink" href="#" target="_blank" class="moni-btn-primary" style="text-decoration:none;display:flex"><span>💬</span> Consultar por WhatsApp</a></div>
    </div>

    <div class="moni-card" id="moniMyLoan"><div class="moni-card-title"><div class="moni-card-title-icon">💸</div>Mi préstamo activo</div><div id="moniMyLoanContent" style="font-size:14px;color:#64748b">Cargando...</div></div>

    <div class="moni-trust-strip">
      <div class="moni-trust-item"><span class="moni-trust-icon">🔒</span> Datos protegidos</div>
      <div class="moni-trust-item"><span class="moni-trust-icon">✅</span> Firma Ley 25.506</div>
      <div class="moni-trust-item"><span class="moni-trust-icon">⚡</span> Respuesta rápida</div>
    </div>
  </div>
</div>

<!-- ============================================
     SUPERADMIN PANEL
     ============================================ -->
<div class="superadmin-view" id="superadminView">
  <div class="sa-header">
    <div class="sa-title">🛡️ SuperAdmin <span class="sa-badge">Acceso restringido</span></div>
    <button class="btn-outline btn-sm" id="btnSaLogout">Cerrar sesión</button>
  </div>
  <div class="sa-metrics" id="saMetrics">
    <div class="sa-metric-card"><div class="sa-metric-label">Prestamistas</div><div class="sa-metric-val" id="saCountLenders">—</div></div>
    <div class="sa-metric-card"><div class="sa-metric-label">Activos</div><div class="sa-metric-val" id="saCountActive">—</div></div>
    <div class="sa-metric-card"><div class="sa-metric-label">Pendientes</div><div class="sa-metric-val" id="saCountPending">—</div></div>
    <div class="sa-metric-card"><div class="sa-metric-label">Total préstamos</div><div class="sa-metric-val" id="saCountLoans">—</div></div>
  </div>
  <div class="sa-lenders-table">
    <div class="sa-table-header"><div class="sa-table-title">📋 Listado de prestamistas</div><button class="btn-outline btn-sm" onclick="loadSuperAdmin()">↻ Actualizar</button></div>
    <div class="sa-row sa-row-head"><div>Prestamista</div><div>Email</div><div>Status</div><div>Acción</div></div>
    <div id="saLendersList"><div class="sa-loading"><div class="spinner"></div></div></div>
  </div>
</div>

<!-- ============================================
     PENDING OVERLAY
     ============================================ -->
<div class="pending-overlay" id="pendingOverlay">
  <div class="pending-logo-wrap">
    <div class="pending-logo-mark">P</div>
    <div class="pending-logo-name">Presti<span>fy</span></div>
  </div>
  <div class="pending-badge">⏳ Validación pendiente</div>
  <div class="pending-title">Tu financiera está siendo validada</div>
  <div class="pending-msg">Estamos revisando tu registro para activar tu cuenta.<br><strong>Te contactaremos a la brevedad.</strong></div>
  <a href="https://wa.me/542966678029" target="_blank" class="pending-wa-btn"><svg viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>Contactar para activar</a>
  <button id="btnPendingLogout" class="pending-logout-btn">Cerrar sesión</button>
</div>

<!-- ============================================
     SUSPENDED OVERLAY
     ============================================ -->
<div class="suspended-overlay" id="suspendedOverlay">
  <div class="suspended-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg></div>
  <div class="suspended-title">Cuenta suspendida</div>
  <div class="suspended-msg">Tu cuenta ha sido pausada. Contactá a soporte para reactivarla.</div>
  <a href="mailto:soporte@prestify.app" class="suspended-contact-btn">Contactar soporte</a>
</div>

<!-- ============================================
     ONBOARDING OVERLAY - 3 PASOS
     ============================================ -->
<div class="onboarding-overlay" id="onboardingOverlay" style="display: none;">
  <div class="onboarding-box">
    <div class="ob-steps">
      <div class="ob-step active" id="obStep1"><div class="ob-step-dot">1</div><div class="ob-step-label">DNI y Firma</div></div>
      <div class="ob-step" id="obStep2"><div class="ob-step-dot">2</div><div class="ob-step-label">Tu Negocio</div></div>
      <div class="ob-step" id="obStep3"><div class="ob-step-dot">3</div><div class="ob-step-label">Método de Cobro</div></div>
    </div>

    <!-- PASO 1 -->
    <div class="ob-content active" id="obContent1">
      <div class="ob-title">Bienvenido a la plataforma</div>
      <div class="ob-subtitle">Verificamos tu identidad y aceptás los términos de uso antes de comenzar.</div>
      
      <div class="input-row" style="margin-bottom:16px">
        <div class="field" style="margin-bottom:0"><label>Nombre completo</label><input id="obName" placeholder="Juan Pérez"></div>
        <div class="field" style="margin-bottom:0"><label>DNI</label><input id="obDni" inputmode="numeric" placeholder="30123456"></div>
      </div>
      <div class="field" style="margin-bottom:16px"><label>Email</label><input id="obEmail" type="email" placeholder="correo@mail.com"></div>

      <div class="ob-consent-box">
        <p><strong>Términos de Uso de la Plataforma Prestify</strong></p>
        <p>Al registrarte y utilizar esta plataforma, aceptás los siguientes términos:</p>
        <p>1. El uso de la plataforma está sujeto al pago de las suscripciones o tarifas vigentes.</p>
        <p>2. El administrador puede pausar o eliminar la cuenta por incumplimiento de pagos.</p>
        <p>3. El prestador es responsable del cumplimiento de normativas locales.</p>
        <p>4. Datos protegidos según Ley 25.326.</p>
        <p>5. Firma electrónica válida según Ley 25.506.</p>
        <p>6. La plataforma es solo una herramienta de gestión.</p>
      </div>

      <label class="ob-consent-check">
        <input type="checkbox" id="obConsentCheck">
        <span>Leí y acepto los Términos de Uso.</span>
      </label>

      <div style="margin-bottom:10px">
        <div style="font-size:11px;font-weight:700;color:var(--ice);text-transform:uppercase;letter-spacing:.9px;margin-bottom:8px">Firma digital (Ley 25.506)</div>
        <div class="ob-sig-wrap"><canvas id="obSigCanvas"></canvas></div>
        <div style="display:flex;gap:8px;margin-top:8px"><button id="btnObClearSig" class="btn-outline btn-sm">Borrar firma</button><span style="font-size:11px;color:var(--muted)">Firmá con el dedo o mouse</span></div>
      </div>

      <div class="ob-nav"><button id="btnObStep1" class="btn-primary" style="flex:1">Continuar al paso 2 →</button></div>
    </div>

    <!-- PASO 2 -->
    <div class="ob-content" id="obContent2">
      <div class="ob-title">Configurá tu negocio</div>
      <div class="ob-subtitle">Estos datos aparecerán en tus contratos y en el portal de clientes.</div>
      <div class="field"><label>Nombre del negocio</label><input id="obAppName" placeholder="Mi Financiera"></div>
      <div class="field"><label>Ciudad de operación</label><input id="obCity" placeholder="Buenos Aires"></div>
      <div class="input-row"><div class="field"><label>TNA %</label><input id="obTna" inputmode="numeric" class="mono" placeholder="100"></div><div class="field"><label>Día de vencimiento (1-28)</label><input id="obDueDay" inputmode="numeric" placeholder="10"></div></div>
      <div class="input-row"><div class="field"><label>% Gastos administrativos</label><input id="obExpenses" inputmode="numeric" placeholder="0" class="mono"></div><div class="field"><label>WhatsApp</label><input id="obWa" inputmode="tel" placeholder="5492966123456"></div></div>
      <div class="ob-nav"><button id="btnObBack1" class="btn-outline" style="flex:0 0 auto">← Atrás</button><button id="btnObStep2" class="btn-primary" style="flex:1">Continuar al paso 3 →</button></div>
    </div>

    <!-- PASO 3 -->
    <div class="ob-content" id="obContent3">
      <div class="ob-title">Método de cobro</div>
      <div class="ob-subtitle">Elegí cómo van a pagar tus clientes.</div>
      <div class="payment-method-selector">
        <div class="pm-option selected" id="pmOptMP" onclick="window.selectPayMethod('mp')"><div class="pm-icon">💳</div><div class="pm-name">Mercado Pago</div><div class="pm-desc">Cobro automático online</div></div>
        <div class="pm-option" id="pmOptManual" onclick="window.selectPayMethod('manual')"><div class="pm-icon">🏦</div><div class="pm-name">Transferencia manual</div><div class="pm-desc">Cliente sube comprobante</div></div>
      </div>
      <div id="obMpFields"><div class="field"><label>Access Token</label><input id="obMpToken" type="password" placeholder="APP_USR-xxx"></div><div class="field"><label>Public Key</label><input id="obMpPublicKey" placeholder="APP_USR-xxx"></div></div>
      <div id="obManualMsg" style="display:none;padding:14px;background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.2);border-radius:12px;margin-bottom:16px"><p style="font-size:13px;color:#fbbf24">📋 Modo transferencia manual activo</p></div>
      <div class="ob-nav"><button id="btnObBack2" class="btn-outline">← Atrás</button><button id="btnObFinish" class="btn-primary" style="background:linear-gradient(135deg,#059669,var(--ok))">✓ Crear mi cuenta</button></div>
    </div>
  </div>
</div>

<!-- ============================================
     TOAST CONTAINER
     ============================================ -->
<div class="toast-container" id="toastContainer"></div>

<!-- ============================================
     ALERT BANNER
     ============================================ -->
<div class="alert-banner" id="alertBanner"><span style="font-size:20px">🔔</span><span id="alertBannerText">Nueva solicitud</span><button class="alert-banner-close" id="alertBannerClose">✕</button></div>

<!-- ============================================
     TOPBAR
     ============================================ -->
<header class="topbar">
  <div class="topbar-inner">
    <a href="#" class="logo" id="logoLink"><div class="logo-mark" id="logoMark">P</div><span class="logo-name" id="logoName">Presti<span>fy</span></span></a>
    <nav class="topbar-nav">
      <button id="btnViewClient" class="nav-btn" style="display:none"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Cliente</span></button>
      <button id="btnViewAdmin" class="nav-btn" style="display:none"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Admin</span></button>
      <button id="btnViewSuperAdmin" class="nav-btn" style="display:none"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><circle cx="12" cy="12" r="3"/></svg><span>SuperAdmin</span></button>
      <div class="nav-sep"></div>
      <div class="notif-wrap" id="notifWrap" style="display:none">
        <button class="notif-bell" id="notifBell"><svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><span class="notif-badge" id="notifBadge">0</span></button>
        <div class="notif-dropdown" id="notifDropdown"><div class="notif-header"><span>Alertas</span><button id="btnClearNotifs">Limpiar</button></div><div class="notif-list" id="notifList"><div class="notif-empty">Sin notificaciones</div></div></div>
      </div>
      <button id="btnResetPass" class="nav-btn"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>Llave</span></button>
      <button id="btnLogout" class="nav-btn danger" style="display:none"><svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><span>Salir</span></button>
    </nav>
  </div>
</header>

<!-- ============================================
     HERO SECTION
     ============================================ -->
<section class="hero-section" id="heroSection" style="display:none">
  <div>
    <div class="hero-eyebrow" id="heroEyebrow">Prestify · Tu financiera</div>
    <h1 class="hero-title">Préstamos personales<br><em>rápidos y seguros</em></h1>
    <p class="hero-sub">Simulá, solicitá y gestioná tu préstamo en minutos.</p>
    <div class="hero-badges"><div class="badge"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>SSL Seguro</div><div class="badge"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>Datos protegidos</div><div class="badge"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>Sin burocracia</div></div>
  </div>
  <div class="hero-kpis"><div class="kpi-box"><div class="kpi-label">TNA vigente</div><div class="kpi-value" id="heroTna">—<small>%</small></div></div><div class="kpi-box"><div class="kpi-label">Día de pago</div><div class="kpi-value" id="heroDue">—<small>del mes</small></div></div></div>
</section>

<!-- ============================================
     MAIN CONTENT
     ============================================ -->
<main class="main-wrap">
  <!-- VISTA CLIENTE (logueado) -->
  <div id="clientView" style="display:none">
    <div class="lender-brand-header" id="lenderBrandHeader" style="display:none"><div class="lender-brand-name" id="lenderBrandName">Mi Financiera</div><div class="lender-brand-tagline">Préstamos rápidos</div></div>
    <div class="client-grid">
      <div class="card">
        <div class="card-title"><svg viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>Simulador</div>
        <div class="sim-meta"><div class="sim-meta-item">TNA <strong id="lblTna">--%</strong></div><div class="sim-meta-item">Vence día <strong id="lblDue">--</strong></div><div class="sim-meta-item">Gasto otorg. <strong>3%</strong></div></div>
        <div id="clientAmountWrap"><div class="client-amount-label">¿Cuánto necesitás?</div><div class="client-amount-display" id="clientAmountDisplay">$ 50.000</div><input type="range" id="clientAmountSlider" class="client-amount-slider" min="5000" max="1000000" value="50000"><div class="slider-labels"><span>$5.000</span><span>$1.000.000</span></div></div>
        <div id="adminAmountWrap" style="display:none"><input id="simAmountInput" placeholder="$ 500.000"></div>
        <div id="adminPlazoWrap"><select id="simMonths"><option value="">Plazo</option></select></div>
        <div id="clientPillsWrap"><div class="client-pills-wrap" id="clientPillsContainer"></div><input type="hidden" id="simMonthsHidden"></div>
        <button id="btnSim" class="btn-primary" onclick="window.calculateLoan()"><svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Calcular</button>
        <div id="simResult"></div>
      </div>
      <div class="card">
        <div class="card-title"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>Solicitud</div>
        <div class="input-row"><div class="field"><label>Nombre</label><input id="bName"></div><div class="field"><label>DNI</label><input id="bDni"></div></div>
        <div class="input-row"><div class="field"><label>Email</label><input id="bEmail" type="email"></div><div class="field"><label>WhatsApp</label><input id="bPhone"></div></div>
        <div class="field"><label>Alias/CBU</label><input id="bAlias"></div>
        <button id="btnSendReq" class="btn-primary">Enviar solicitud</button>
      </div>
      <div class="card full-width" id="myloan"><div class="card-title">Mi préstamo</div><div id="loanStatus"><div class="empty">Sin préstamos activos</div></div></div>
    </div>
  </div>

  <!-- VISTA ADMIN -->
  <div id="adminView" style="display:none">
    <div class="kpi-grid" id="kpiGrid">
      <div class="kpi-card"><div class="kpi-card-label">Capital activo</div><div class="kpi-card-val" id="kpiCapital">$0</div></div>
      <div class="kpi-card"><div class="kpi-card-label">Ingresos mes</div><div class="kpi-card-val" id="kpiMonthly">$0</div></div>
      <div class="kpi-card"><div class="kpi-card-label">Préstamos activos</div><div class="kpi-card-val" id="kpiActive">0</div></div>
      <div class="kpi-card"><div class="kpi-card-label">En mora</div><div class="kpi-card-val" id="kpiMora">0</div></div>
      <div class="kpi-card"><div class="kpi-card-label">Pendientes</div><div class="kpi-card-val" id="kpiPending">0</div></div>
      <div class="kpi-card"><div class="kpi-card-label">Cobrado hoy</div><div class="kpi-card-val" id="kpiToday">$0</div></div>
    </div>
    <div class="tab-bar" id="adminTabBar">
      <button class="tab-btn active" data-tab="tabDash">Dashboard</button>
      <button class="tab-btn" data-tab="tabPending">Pendientes <span class="tab-badge" id="badgePending">0</span></button>
      <button class="tab-btn" data-tab="tabPre">Preaprobados <span class="tab-badge" id="badgePre">0</span></button>
      <button class="tab-btn" data-tab="tabActive">Activos</button>
      <button class="tab-btn" data-tab="tabMora">Mora</button>
      <button class="tab-btn" data-tab="tabComprobantes">Comprobantes <span class="tab-badge" id="badgeComp">0</span></button>
      <button class="tab-btn" data-tab="tabHistory">Histórico</button>
      <button class="tab-btn" data-tab="tabCfg">⚙ Config</button>
    </div>
    <div id="adminContent">
      <div class="tab-content active" id="tabDash"><div class="card"><div class="card-title">Resumen</div><div id="dashContent"><div class="empty"><div class="spinner"></div></div></div></div></div>
      <div class="tab-content" id="tabCfg">[Configuración]</div>
      <div class="tab-content" id="tabPending"><div class="card"><div class="card-title">Pendientes</div><div id="listPending"><div class="empty"><div class="spinner"></div></div></div></div></div>
      <div class="tab-content" id="tabPre"><div class="card"><div class="card-title">Preaprobados</div><div id="listPre"><div class="empty"><div class="spinner"></div></div></div></div></div>
      <div class="tab-content" id="tabActive"><div class="card"><div class="card-title">Activos</div><div id="listActive"><div class="empty"><div class="spinner"></div></div></div></div></div>
      <div class="tab-content" id="tabMora"><div class="card"><div class="card-title">Mora</div><div id="listMora"><div class="empty"><div class="spinner"></div></div></div></div></div>
      <div class="tab-content" id="tabComprobantes"><div class="card"><div class="card-title">Comprobantes</div><div id="listComp"><div class="empty"><div class="spinner"></div></div></div></div></div>
      <div class="tab-content" id="tabHistory"><div class="card"><div class="card-title">Histórico</div><div id="listInact"><div class="empty">Sin registros</div></div></div></div>
    </div>
  </div>
</main>

<!-- ============================================
     MODALES
     ============================================ -->
<div class="modal-overlay" id="sigModal"><div class="modal-box"><div class="modal-title">Firma digital</div><div class="sig-canvas-wrap"><canvas id="sigCanvas"></canvas></div><div class="sig-actions"><button id="btnClearSig">Borrar</button><button id="btnConfirmSig">Confirmar</button></div><button id="btnCancelSig">Cancelar</button></div></div>

<div class="modal-overlay" id="activateModal"><div class="modal-box"><div class="modal-title">Activar préstamo</div><div class="activate-summary" id="activateSummary"></div><div><button id="btnCancelActivate">Cancelar</button><button id="btnConfirmActivate">Confirmar</button></div></div></div>

<!-- ============================================
     SCRIPT - FUNCIONES GLOBALES (FALLBACK)
     ============================================ -->
<script>
// Funciones globales para el onboarding
window.nextStep = window.nextStep || function(step) {
  [1,2,3].forEach(s => {
    const stepEl = document.getElementById(`obStep${s}`);
    const contentEl = document.getElementById(`obContent${s}`);
    if (stepEl && contentEl) {
      stepEl.className = s === step ? 'ob-step active' : s < step ? 'ob-step done' : 'ob-step';
      contentEl.className = s === step ? 'ob-content active' : 'ob-content';
    }
  });
};

window.prevStep = window.prevStep || function(step) {
  if (step - 1 >= 1) window.nextStep(step - 1);
};

window.selectPayMethod = window.selectPayMethod || function(method) {
  document.getElementById('pmOptMP')?.classList.toggle('selected', method === 'mp');
  document.getElementById('pmOptManual')?.classList.toggle('selected', method === 'manual');
  document.getElementById('obMpFields').style.display = method === 'mp' ? 'block' : 'none';
  document.getElementById('obManualMsg').style.display = method === 'manual' ? 'block' : 'none';
};

window.handleSignup = window.handleSignup || function() {
  document.getElementById('landingView').style.display = 'none';
  document.getElementById('onboardingOverlay').style.display = 'flex';
};

window.moniUpdateSlider = window.moniUpdateSlider || function(slider) {
  const val = parseInt(slider.value) || 50000;
  const display = document.getElementById('moniAmountDisplay');
  if (display) display.textContent = '$ ' + val.toLocaleString('es-AR');
  const pct = ((val - parseInt(slider.min)) / (parseInt(slider.max) - parseInt(slider.min))) * 100;
  slider.style.background = 'linear-gradient(to right, #10b981 0%, #10b981 ' + pct + '%, #e2e8f0 ' + pct + '%)';
};

window.moniSimular = window.moniSimular || function() {
  alert('Función de simulación en script.js');
};

window.moniShowForm = window.moniShowForm || function() {
  document.getElementById('moniSimResult').style.display = 'none';
  document.getElementById('moniFormSection').style.display = 'block';
};

window.moniEnviarSolicitud = window.moniEnviarSolicitud || function() {
  alert('Función de envío en script.js');
};

console.log('✅ Funciones de respaldo listas');
</script>

<!-- ============================================
     SCRIPT PRINCIPAL (JS COMPLETO INCLUIDO)
     ============================================ -->
<script type="module">
// ========== JS COMPLETO INCLUIDO AQUÍ ==========
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail }
  from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, collection, doc, getDoc, getDocs, setDoc, addDoc, updateDoc, deleteDoc,
         serverTimestamp, query, where, orderBy, limit, onSnapshot, writeBatch }
  from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
import { getStorage, ref as sRef, uploadString, getDownloadURL }
  from "https://www.gstatic.com/firebasejs/10.12.5/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBuLQHhsOBTr2e8Kp5HKUz-a7xXgrgLlUI",
  authDomain: "estimapres.firebaseapp.com",
  projectId: "estimapres",
  storageBucket: "estimapres.firebasestorage.app",
  messagingSenderId: "578516597437",
  appId: "1:578516597437:web:f59994b87729aa1cd655d4"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

const GASTO_OTORGAMIENTO = 3;
const SUPER_ADMIN_UID = "cuQqbuHWkTWdFPdknVTUAkx5Xri2";

const fmtMoney = n => isNaN(n) || n == null ? "$ 0" : "$ " + Number(Math.round(n)).toLocaleString("es-AR");
const digits = v => (v || "").replace(/\D+/g, "");
const nowTS = () => serverTimestamp();
const daysLate = iso => Math.max(0, Math.floor((Date.now() - new Date(iso).getTime()) / 86400000));
const el = id => document.getElementById(id);

function toast(msg, type = "info", dur = 3800) {
  const c = el("toastContainer");
  if (!c) return;
  const t = document.createElement("div");
  t.className = `toast ${type}`;
  t.textContent = msg;
  c.appendChild(t);
  setTimeout(() => t.remove(), dur);
}

function annuity(P, rate, m) {
  const i = (rate / 100) / 12;
  if (i === 0) return P / m;
  return P * i * Math.pow(1 + i, m) / (Math.pow(1 + i, m) - 1);
}

function calculateFrenchLoan(amount, months, tna) {
  const gastoOtorgAmt = Math.round(amount * GASTO_OTORGAMIENTO / 100);
  const capitalFinanciar = amount + gastoOtorgAmt;
  const cuota = Math.round(annuity(capitalFinanciar, tna, months));
  const totalAPagar = cuota * months;
  return {
    amount, months, tna, gastoOtorgAmt, capitalFinanciar, cuota, totalAPagar,
    intereses: totalAPagar - capitalFinanciar
  };
}

function scheduleRows(L) {
  const due = L.dueDay || 10;
  const base = L.activeAt?.toDate ? L.activeAt.toDate() : new Date();
  const gastoOtorgAmt = L.gastoOtorgAmt || Math.round((L.amount || 0) * GASTO_OTORGAMIENTO / 100);
  const capFin = L.capitalFinanciar || (L.amount || 0) + gastoOtorgAmt;
  const inst = (L.installment && L.installment > 0) ? L.installment : Math.round(annuity(capFin, L.tna, L.months));
  return Array.from({ length: L.months }, (_, k) => {
    const d = new Date(base.getFullYear(), base.getMonth() + k + 1, 1);
    d.setDate(Math.min(due, 28));
    return { n: k + 1, due: d.toISOString().slice(0, 10), amount: inst, paid: (L.paidCount || 0) > k };
  });
}

let gUser = null, gLenderId = null, gRefLenderId = null;
let gSettings = {
  tna: null, dueDay: null, appName: "Prestify", city: "Río Gallegos, Santa Cruz",
  expenses: 0, wa: "", logoBase64: "", mpToken: "", mpPublicKey: "",
  status: "activo", plazos: [3, 6, 9, 12, 18, 24], brandColor: "#1a56db", maxAmount: 1000000
};
let gActivateLoan = null, inactTab = "paid";
let gNotifications = [], gSnapshotUnsub = null, gStatusUnsub = null, knownPendingIds = new Set();
let gObSigData = null, gObPayMethod = "mp";

window.gSettings = gSettings;

window.nextStep = function(step) {
  const steps = [1, 2, 3];
  steps.forEach(s => {
    const stepEl = document.getElementById(`obStep${s}`);
    const contentEl = document.getElementById(`obContent${s}`);
    if (stepEl && contentEl) {
      if (s === step) {
        stepEl.className = 'ob-step active';
        contentEl.className = 'ob-content active';
      } else if (s < step) {
        stepEl.className = 'ob-step done';
        contentEl.className = 'ob-content';
      } else {
        stepEl.className = 'ob-step';
        contentEl.className = 'ob-content';
      }
    }
  });
};

window.prevStep = function(step) {
  const prev = step - 1;
  if (prev >= 1) window.nextStep(prev);
};

window.handleSignup = function() {
  showOnboarding();
};

window.calculateLoan = function() {
  const amountInput = document.getElementById('simAmountInput') || 
                      document.getElementById('clientAmountSlider') ||
                      document.getElementById('simAmount');
  const monthsSelect = document.getElementById('simMonths');
  const monthsHidden = document.getElementById('simMonthsHidden');
  
  let amount = 0, months = 0;
  
  if (amountInput) {
    if (amountInput.type === 'range' || amountInput.type === 'hidden') {
      amount = parseInt(amountInput.value) || 0;
    } else {
      amount = parseInt((amountInput.value || '').replace(/\D/g, '')) || 0;
    }
  }
  
  if (monthsSelect && monthsSelect.value) {
    months = parseInt(monthsSelect.value) || 0;
  } else if (monthsHidden && monthsHidden.value) {
    months = parseInt(monthsHidden.value) || 0;
  }
  
  if (!amount || !months) {
    toast('Completá el monto y plazo primero', 'err');
    return null;
  }
  
  const tna = gSettings?.tna || 100;
  const result = calculateFrenchLoan(amount, months, tna);
  const simResult = document.getElementById('simResult');
  
  if (simResult) {
    const expP = gSettings.expenses || 0;
    const expA = Math.round(amount * expP / 100);
    simResult.innerHTML = `
      <div class="sim-result-box">
        <div class="sim-cuota-display">
          <span class="sim-cuota-label">Cuota mensual</span>
          <span class="sim-cuota-value">${fmtMoney(result.cuota)}</span>
        </div>
        <div class="breakdown-box">
          <div class="breakdown-row"><span class="bl">Monto solicitado</span><span class="bv">${fmtMoney(amount)}</span></div>
          <div class="breakdown-row warn-row"><span class="bl">Gasto de otorgamiento (${GASTO_OTORGAMIENTO}%)</span><span class="bv">+ ${fmtMoney(result.gastoOtorgAmt)}</span></div>
          <div class="breakdown-row"><span class="bl">Capital a financiar</span><span class="bv">${fmtMoney(result.capitalFinanciar)}</span></div>
          ${expP > 0 ? `<div class="breakdown-row warn-row"><span class="bl">Gastos administrativos (${expP}%)</span><span class="bv">- ${fmtMoney(expA)}</span></div>` : ""}
          <div class="breakdown-row"><span class="bl">Neto a recibir</span><span class="bv" style="color:var(--ok)">${fmtMoney(amount - expA)}</span></div>
          <div class="breakdown-row"><span class="bl">Intereses proyectados</span><span class="bv" style="color:var(--purple)">${fmtMoney(result.intereses)}</span></div>
          <div class="breakdown-row accent"><span class="bl">Total a pagar</span><span class="bv">${fmtMoney(result.totalAPagar)}</span></div>
        </div>
      </div>
    `;
  }
  return result;
};

window.closeDemoModal = function() {
  const modal = document.getElementById('demoModal');
  if (modal) modal.classList.remove('open');
};

window.selectPayMethod = function(method) {
  gObPayMethod = method;
  const mpOpt = document.getElementById('pmOptMP');
  const manualOpt = document.getElementById('pmOptManual');
  const mpFields = document.getElementById('obMpFields');
  const manualMsg = document.getElementById('obManualMsg');
  if (mpOpt) mpOpt.classList.toggle('selected', method === 'mp');
  if (manualOpt) manualOpt.classList.toggle('selected', method === 'manual');
  if (mpFields) mpFields.style.display = method === 'mp' ? 'block' : 'none';
  if (manualMsg) manualMsg.style.display = method === 'manual' ? 'block' : 'none';
};

window.moniUpdateSlider = function(slider) {
  const val = parseInt(slider.value) || 50000;
  const display = document.getElementById('moniAmountDisplay');
  if (display) display.textContent = '$ ' + val.toLocaleString('es-AR');
  const pct = ((val - parseInt(slider.min)) / (parseInt(slider.max) - parseInt(slider.min))) * 100;
  slider.style.background = 'linear-gradient(to right, #10b981 0%, #10b981 ' + pct + '%, #e2e8f0 ' + pct + '%)';
};

window.moniSimular = function() {
  if (typeof moniSimular === 'function') moniSimular();
};

window.moniShowForm = function() {
  const simResult = document.getElementById('moniSimResult');
  const formSection = document.getElementById('moniFormSection');
  if (simResult) simResult.style.display = 'none';
  if (formSection) {
    formSection.style.display = 'block';
    formSection.scrollIntoView({behavior: 'smooth', block: 'start'});
  }
};

window.moniEnviarSolicitud = function() {
  if (typeof moniEnviarSolicitud === 'function') moniEnviarSolicitud();
};

(() => {
  const params = new URLSearchParams(location.search);
  const urlRef = params.get("ref");
  if (urlRef) {
    gRefLenderId = urlRef;
    sessionStorage.setItem("prestify_ref", urlRef);
  } else {
    sessionStorage.removeItem("prestify_ref");
    gRefLenderId = null;
  }
})();

function showLandingPage() {
  el("landingView")?.classList.add("show");
  document.body.classList.add("landing-active");
  el("heroSection").style.display = "none";
  el("clientView").style.display = "none";
  el("adminView").className = "admin-wrap";
  el("superadminView")?.classList.remove("show");
  el("btnViewClient").style.display = "none";
  el("btnViewAdmin").style.display = "none";
  renderLandingPage();
}

function hideLandingPage() {
  el("landingView")?.classList.remove("show");
  document.body.classList.remove("landing-active");
  el("btnViewClient").style.display = "";
  el("btnViewAdmin").style.display = "";
}

function renderLandingPage() {
  const lv = el("landingView");
  if (!lv) return;
  document.body.classList.add("landing-active");
  const rvEls = lv.querySelectorAll(".rv");
  if (!rvEls.length) return;
  const io = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add("visible");
        io.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1, rootMargin: "0px 0px -30px 0px" });
  rvEls.forEach(e => io.observe(e));
}

(() => {
  if (!gRefLenderId) {
    el("btnViewClient").style.display = "none";
    el("btnViewAdmin").style.display = "none";
    requestAnimationFrame(() => setTimeout(renderLandingPage, 60));
  } else {
    const lv = el("landingView");
    if (lv) lv.classList.remove("show");
    document.body.classList.remove("landing-active");
    el("heroSection").style.display = "none";
    el("clientView").style.display = "none";
    el("btnViewClient").style.display = "none";
    el("btnViewAdmin").style.display = "none";
  }
})();

function openRegisterFlow() {
  if (auth.currentUser) {
    signOut(auth).then(() => {
      hideLandingPage();
      el("heroSection").style.display = "none";
      el("clientView").style.display = "none";
      el("adminView").className = "admin-wrap visible";
      el("btnViewClient").style.display = "";
      el("btnViewAdmin").style.display = "";
      requestAnimationFrame(() => {
        const gate = el("adminGate");
        if (gate) gate.scrollIntoView({ behavior: "smooth", block: "center" });
      });
    });
    return;
  }
  hideLandingPage();
  el("heroSection").style.display = "none";
  el("clientView").style.display = "none";
  el("adminView").className = "admin-wrap visible";
  el("btnViewClient").style.display = "";
  el("btnViewAdmin").style.display = "";
  requestAnimationFrame(() => {
    const gate = el("adminGate");
    if (gate) gate.scrollIntoView({ behavior: "smooth", block: "center" });
  });
}

el("btnLandingRegister")?.addEventListener("click", openRegisterFlow);
el("btnLandingRegister2")?.addEventListener("click", openRegisterFlow);
el("btnLandingLogin")?.addEventListener("click", e => { e.preventDefault(); openRegisterFlow(); });

const effectiveLid = () => gLenderId || gRefLenderId;
const loanQ = (...c) => query(collection(db, "loans"), where("lenderId", "==", effectiveLid()), ...c);
const settRef = () => doc(db, "settings", effectiveLid());
const lenderRef = id => doc(db, "lenders", id);
const hasMpToken = () => !!(gSettings.mpToken && gSettings.mpToken.length > 10);

function checkSuspended() {
  if (gSettings.status === "pausado") {
    el("suspendedOverlay").classList.add("show");
    el("pendingOverlay").classList.remove("show");
    const adminC = el("adminContent");
    if (adminC) adminC.style.display = "none";
    return true;
  }
  el("suspendedOverlay").classList.remove("show");
  return false;
}

function checkPending() {
  if (gSettings.status === "pendiente") {
    el("pendingOverlay").classList.add("show");
    const adminC = el("adminContent");
    if (adminC) adminC.style.display = "none";
    return true;
  }
  el("pendingOverlay").classList.remove("show");
  return false;
}

async function loadLenderBranding(lid) {
  try {
    const snap = await getDoc(lenderRef(lid));
    if (!snap.exists()) return;
    const d = snap.data();
    if (d.primaryColor) document.documentElement.style.setProperty("--blue", d.primaryColor);
    if (d.accentColor) document.documentElement.style.setProperty("--sky", d.accentColor);
    Object.assign(gSettings, {
      appName: d.appName || gSettings.appName,
      city: d.city || gSettings.city,
      tna: d.tna || gSettings.tna,
      dueDay: d.dueDay || gSettings.dueDay,
      expenses: d.expenses || gSettings.expenses,
      logoBase64: d.logoBase64 || gSettings.logoBase64,
      wa: d.wa || gSettings.wa,
      mpToken: d.mpToken || "",
      mpPublicKey: d.mpPublicKey || "",
      status: d.status || "activo",
      plazos: d.plazos || gSettings.plazos,
      brandColor: d.brandColor || gSettings.brandColor || "#1a56db",
      maxAmount: d.maxAmount || gSettings.maxAmount || 1000000
    });
    applyBranding();
    refreshSimMeta();
  } catch (e) { console.warn("Branding:", e); }
}

function applyBranding() {
  const name = gSettings.appName || "Prestify";
  document.title = name + " · Tu financiera, digitalizada";
  const mark = document.getElementById("logoMark");
  if (mark) {
    if (gSettings.logoBase64) {
      mark.innerHTML = `<img src="${gSettings.logoBase64}" alt="logo"/>`;
    } else {
      mark.textContent = name.replace(/\s+/g, "").slice(0, 1).toUpperCase();
    }
  }
  const mid = Math.ceil(name.length / 2);
  const ln = document.getElementById("logoName");
  if (ln) ln.innerHTML = `${name.slice(0, mid)}<span>${name.slice(mid)}</span>`;
  
  const brandColor = gSettings.brandColor || "#1a56db";
  document.documentElement.style.setProperty("--brand-color", brandColor);
  document.documentElement.style.setProperty("--blue", brandColor);
  document.documentElement.style.setProperty("--blue-light", brandColor);
  
  if (gRefLenderId && !gLenderId) {
    document.body.classList.add("client-mode");
    const style = document.createElement('style');
    style.textContent = `
      body.client-mode .btn-primary { background: ${brandColor} !important; }
      body.client-mode .client-pill.active { background: ${brandColor}; border-color: ${brandColor}; }
      body.client-mode .client-amount-display { color: ${brandColor}; }
    `;
    document.head.appendChild(style);
    
    const maxAmt = gSettings.maxAmount || 1000000;
    const sliderEl = document.getElementById("clientAmountSlider");
    if (sliderEl) {
      sliderEl.max = maxAmt;
      if (Number(sliderEl.value) > maxAmt) sliderEl.value = Math.round(maxAmt * 0.05);
      const disp = document.getElementById("clientAmountDisplay");
      if (disp) disp.textContent = "$ " + Number(sliderEl.value).toLocaleString("es-AR");
      const sa = document.getElementById("simAmount");
      if (sa) sa.value = sliderEl.value;
    }
    const maxLbl = document.getElementById("sliderMaxLabel");
    if (maxLbl) maxLbl.textContent = "$ " + maxAmt.toLocaleString("es-AR");
    const bh = document.getElementById("lenderBrandHeader");
    if (bh) bh.style.display = "";
    const bn = document.getElementById("lenderBrandName");
    if (bn) bn.textContent = name;
  }
}

async function loadSettings() {
  if (!effectiveLid()) return;
  try {
    const s = await getDoc(settRef());
    if (s.exists()) gSettings = { ...gSettings, ...s.data() };
  } catch {}
  if (gRefLenderId && !gLenderId) await loadLenderBranding(gRefLenderId);
  applyBranding();
  refreshSimMeta();
  
  const sv = (id, v) => { const e = el(id); if (e) e.value = v || ""; };
  sv("cfgTna", gSettings.tna || "");
  sv("cfgDue", gSettings.dueDay || "");
  sv("cfgAppName", gSettings.appName || "");
  sv("cfgCity", gSettings.city || "");
  sv("cfgExpenses", gSettings.expenses || 0);
  sv("cfgWa", gSettings.wa || "");
  sv("cfgMaxAmount", gSettings.maxAmount || 1000000);

  const mpTok = el("cfgMpToken");
  if (mpTok) mpTok.placeholder = gSettings.mpToken ? "••••••••••••••••" : "APP_USR-xxxxxxxxxxxx";
  const mpPub = el("cfgMpPublicKey");
  if (mpPub) mpPub.value = gSettings.mpPublicKey || "";

  const prev = el("cfgLogoPreview");
  if (prev) {
    if (gSettings.logoBase64) prev.innerHTML = `<img src="${gSettings.logoBase64}" alt="logo"/>`;
    else prev.textContent = (gSettings.appName || "P").replace(/\s+/g, "").slice(0, 2).toUpperCase();
  }
  const bcEl = el("cfgBrandColor");
  if (bcEl && gSettings.brandColor) bcEl.value = gSettings.brandColor;

  const mpB = el("mpStatusBadge");
  if (mpB) mpB.innerHTML = gSettings.mpToken
    ? `<span class="mp-connected">Mercado Pago conectado y activo</span>`
    : `<span class="mp-disconnected">Sin token MP — modo transferencia manual activo</span>`;

  const plazosActivos = Array.isArray(gSettings.plazos) && gSettings.plazos.length > 0
    ? gSettings.plazos : [3, 6, 9, 12, 18, 24];
  for (let n = 1; n <= 24; n++) {
    const cb = el(`plazo${n}`);
    if (cb) cb.checked = plazosActivos.includes(n);
  }
  refreshPlazoSelector();

  const linkEl = el("myLinkPreview");
  if (linkEl && gLenderId) linkEl.textContent = location.origin + location.pathname + "?ref=" + gLenderId;

  if (gLenderId) { checkSuspended(); checkPending(); }
}

function refreshSimMeta() {
  const s = (id, v) => { const e = el(id); if (e) e.textContent = v; };
  s("lblTna", (gSettings.tna || "--") + "%");
  s("lblDue", gSettings.dueDay || "--");
  const h = el("heroTna");
  if (h) h.innerHTML = gSettings.tna ? `${gSettings.tna}<small>%</small>` : `&#8212;<small>%</small>`;
  const d = el("heroDue");
  if (d) d.innerHTML = gSettings.dueDay ? `${gSettings.dueDay}<small>del mes</small>` : `&#8212;<small>del mes</small>`;
  if (gSettings.expenses > 0) {
    const m = el("lblExpMeta"); if (m) m.style.display = "";
    const le = el("lblExp"); if (le) le.textContent = gSettings.expenses + "%";
  }
  refreshPlazoSelector();
}

function refreshPlazoSelector() {
  const sel = el("simMonths");
  if (sel) {
    const plazos = Array.isArray(gSettings.plazos) && gSettings.plazos.length > 0
      ? [...gSettings.plazos].sort((a, b) => a - b) : [3, 6, 9, 12, 18, 24];
    const cur = sel.value;
    sel.innerHTML = `<option value="">— Seleccioná un plazo —</option>`;
    plazos.forEach(n => {
      const opt = document.createElement("option");
      opt.value = n;
      opt.textContent = n + (n === 1 ? " mes" : " meses");
      if (String(n) === String(cur)) opt.selected = true;
      sel.appendChild(opt);
    });
  }
  const pillsContainer = el("clientPillsContainer");
  if (pillsContainer) {
    const plazos = Array.isArray(gSettings.plazos) && gSettings.plazos.length > 0
      ? [...gSettings.plazos].sort((a, b) => a - b) : [3, 6, 9, 12, 18, 24];
    const currentVal = el("simMonthsHidden")?.value || "";
    pillsContainer.innerHTML = plazos.map(n =>
      `<button type="button" class="client-pill${String(n) === String(currentVal) ? " active" : ""}" data-months="${n}">${n} ${n === 1 ? "mes" : "m"}</button>`
    ).join("");
    pillsContainer.querySelectorAll(".client-pill").forEach(pill => {
      pill.addEventListener("click", () => {
        pillsContainer.querySelectorAll(".client-pill").forEach(p => p.classList.remove("active"));
        pill.classList.add("active");
        const mh = el("simMonthsHidden");
        if (mh) mh.value = pill.dataset.months;
        autoSimClient();
      });
    });
  }
}

function getSimMonths() {
  if (gRefLenderId && !gLenderId) return Number(el("simMonthsHidden")?.value || 0);
  return Number(el("simMonths")?.value || 0);
}

function getSimAmount() {
  if (gRefLenderId && !gLenderId) {
    const manualEl = el("clientAmountManual");
    const manualVal = manualEl ? Number(digits(manualEl.value)) : 0;
    if (manualVal > 0) return manualVal;
    return Number(el("clientAmountSlider")?.value || el("simAmount")?.value || 0);
  }
  return Number(digits(el("simAmountInput")?.value || el("simAmount")?.value || ""));
}

function autoSimClient() {
  const amt = getSimAmount(), m = getSimMonths();
  if (!amt || !m || !gSettings.tna) return;
  const gastoOtorgAmt = Math.round(amt * GASTO_OTORGAMIENTO / 100);
  const capitalFinanciar = amt + gastoOtorgAmt;
  const cuota = Math.round(annuity(capitalFinanciar, gSettings.tna, m));
  let hero = el("clientCuotaHero");
  if (!hero) {
    hero = document.createElement("div");
    hero.id = "clientCuotaHero";
    hero.className = "client-cuota-hero";
    const simResult = el("simResult");
    if (simResult) simResult.parentNode.insertBefore(hero, simResult);
  }
  hero.innerHTML = `<div class="client-cuota-label">Tu cuota mensual</div>
    <div class="client-cuota-value">${fmtMoney(cuota)}</div>
    <div class="client-cuota-months">${m} cuotas · TNA ${gSettings.tna}%</div>`;
}

let gObStep = 1;

function initObSigCanvas() {
  const canvas = el("obSigCanvas");
  if (!canvas) return;
  canvas.width = canvas.parentElement.clientWidth || 460;
  canvas.height = 150;
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = "#60a5fa"; ctx.lineWidth = 2.5; ctx.lineCap = "round"; ctx.lineJoin = "round";
  let drawing = false, lx = 0, ly = 0;
  const pos = e => {
    const r = canvas.getBoundingClientRect();
    const s = e.touches ? e.touches[0] : e;
    return { x: s.clientX - r.left, y: s.clientY - r.top };
  };
  canvas.onmousedown = e => { drawing = true; const p = pos(e); lx = p.x; ly = p.y; };
  canvas.onmousemove = e => { if (!drawing) return; const p = pos(e); ctx.beginPath(); ctx.moveTo(lx, ly); ctx.lineTo(p.x, p.y); ctx.stroke(); lx = p.x; ly = p.y; };
  canvas.onmouseup = canvas.onmouseleave = () => drawing = false;
  canvas.ontouchstart = e => { e.preventDefault(); drawing = true; const p = pos(e); lx = p.x; ly = p.y; };
  canvas.ontouchmove = e => { e.preventDefault(); if (!drawing) return; const p = pos(e); ctx.beginPath(); ctx.moveTo(lx, ly); ctx.lineTo(p.x, p.y); ctx.stroke(); lx = p.x; ly = p.y; };
  canvas.ontouchend = e => { e.preventDefault(); drawing = false; };
}

function setObStep(step) {
  gObStep = step;
  [1, 2, 3].forEach(i => {
    el(`obStep${i}`).className = "ob-step" + (i < step ? " done" : i === step ? " active" : "");
    el(`obContent${i}`).className = "ob-content" + (i === step ? " active" : "");
  });
}

async function showOnboarding() {
  gObStep = 1;
  gObSigData = null;
  gObPayMethod = "mp";
  
  ['obName', 'obDni', 'obEmail', 'obAppName', 'obCity', 'obTna', 'obDueDay', 'obExpenses', 'obWa', 'obMpToken', 'obMpPublicKey']
    .forEach(id => { const inp = document.getElementById(id); if (inp) inp.value = ''; });
  
  const consent = document.getElementById('obConsentCheck');
  if (consent) consent.checked = false;
  
  [1, 2, 3].forEach(i => {
    const stepEl = document.getElementById(`obStep${i}`);
    const contentEl = document.getElementById(`obContent${i}`);
    if (stepEl && contentEl) {
      stepEl.className = i === 1 ? 'ob-step active' : 'ob-step';
      contentEl.className = i === 1 ? 'ob-content active' : 'ob-content';
    }
  });
  
  window.selectPayMethod('mp');
  setTimeout(initObSigCanvas, 200);
  const overlay = document.getElementById('onboardingOverlay');
  if (overlay) overlay.classList.add('show');
}

el("btnObClearSig")?.addEventListener("click", () => {
  const c = el("obSigCanvas"); if (!c) return;
  c.getContext("2d").clearRect(0, 0, c.width, c.height);
  gObSigData = null;
});

el("btnObStep1")?.addEventListener("click", () => {
  const name = (el("obName").value || "").trim();
  const dni = digits(el("obDni").value);
  const email = (el("obEmail").value || "").trim();
  if (!name || !dni || !email) { toast("Completá nombre, DNI y email.", "err"); return; }
  if (!el("obConsentCheck").checked) { toast("Debés aceptar los términos de uso.", "err"); return; }
  const canvas = el("obSigCanvas");
  const data = canvas.getContext("2d").getImageData(0, 0, canvas.width, canvas.height).data;
  if (!Array.from(data).some((v, i) => i % 4 === 3 && v > 0)) {
    toast("Dibujá tu firma para continuar.", "err"); return;
  }
  gObSigData = canvas.toDataURL("image/png");
  setObStep(2);
});

el("btnObBack1")?.addEventListener("click", () => setObStep(1));
el("btnObStep2")?.addEventListener("click", () => {
  const appName = (el("obAppName").value || "").trim();
  const tna = Number(digits(el("obTna").value));
  const due = Number(digits(el("obDueDay").value));
  if (!appName) { toast("Ingresá el nombre del negocio.", "err"); return; }
  if (!tna || tna < 1) { toast("Ingresá la TNA.", "err"); return; }
  if (!due || due < 1 || due > 28) { toast("Día de vencimiento entre 1 y 28.", "err"); return; }
  setObStep(3);
});

el("btnObBack2")?.addEventListener("click", () => setObStep(2));

el("btnObFinish")?.addEventListener("click", async () => {
  if (!gLenderId) { 
    if (auth.currentUser) {
      gLenderId = auth.currentUser.uid;
    } else {
      toast("Error de sesión. Recargá la página.", "err"); 
      return; 
    }
  }
  
  el("btnObFinish").disabled = true;
  el("btnObFinish").textContent = "Guardando...";
  
  try {
    const appName = (el("obAppName")?.value || "").trim();
    const tna = Number(digits(el("obTna")?.value));
    const dueDay = Number(digits(el("obDueDay")?.value));
    const city = (el("obCity")?.value || "Río Gallegos, Santa Cruz").trim();
    const expenses = Number(el("obExpenses")?.value || 0);
    const wa = (el("obWa")?.value || "").trim();
    
    if (!appName || !tna || !dueDay) throw new Error("Completá todos los campos del paso 2");
    
    const name = (el("obName")?.value || "").trim();
    const dni = digits(el("obDni")?.value);
    const email = (el("obEmail")?.value || "").trim();
    if (!name || !dni || !email) throw new Error("Faltan datos del paso 1");
    
    const canvas = document.getElementById("obSigCanvas");
    if (!canvas) throw new Error("Error con el canvas de firma");
    
    const ctx = canvas.getContext("2d");
    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
    const hasSignature = Array.from(imgData).some((v, i) => i % 4 === 3 && v > 0);
    if (!hasSignature) throw new Error("Dibujá tu firma en el paso 1");
    
    if (!document.getElementById("obConsentCheck")?.checked) throw new Error("Debés aceptar los términos de uso");
    
    const signatureImg = canvas.toDataURL("image/png");
    const plazos = [3, 6, 9, 12, 18, 24];
    
    const cfg = {
      lenderId: gLenderId, appName, city, tna, dueDay, expenses, wa,
      status: "pendiente", plazos, minAmount: 5000, maxAmount: 1000000,
      brandColor: "#1a56db", onboardingDone: true, onboardingAt: serverTimestamp(),
      operator: { name, dni, email, consentSignedAt: new Date().toISOString(), signatureImg },
      updatedAt: serverTimestamp()
    };
    
    if (gObPayMethod === "mp") {
      const mpToken = (el("obMpToken")?.value || "").trim();
      const mpPublicKey = (el("obMpPublicKey")?.value || "").trim();
      if (mpToken) cfg.mpToken = mpToken;
      if (mpPublicKey) cfg.mpPublicKey = mpPublicKey;
    }
    
    await Promise.all([
      setDoc(doc(db, "settings", gLenderId), cfg, { merge: true }),
      setDoc(doc(db, "lenders", gLenderId), cfg, { merge: true })
    ]);
    
    Object.assign(gSettings, cfg);
    applyBranding();
    refreshSimMeta();
    document.getElementById("onboardingOverlay").classList.remove("show");
    toast("✅ Cuenta registrada. Aguardá la activación.", "ok", 6000);
    checkPending();
    
  } catch (e) {
    toast("Error: " + e.message, "err");
    el("btnObFinish").disabled = false;
    el("btnObFinish").textContent = "✓ Crear mi cuenta";
  }
});

onAuthStateChanged(auth, async u => {
  gUser = u;
  gLenderId = u ? u.uid : null;
  const ok = !!u;
  
  const adminGate = document.getElementById('adminGate');
  const adminContent = document.getElementById('adminContent');
  const btnAdminLogin = document.getElementById('btnAdminLogin');
  const btnLogout = document.getElementById('btnLogout');
  const notifWrap = document.getElementById('notifWrap');
  
  if (adminGate) adminGate.style.display = ok ? "none" : "";
  if (adminContent) adminContent.style.display = ok ? "" : "none";
  if (btnAdminLogin) btnAdminLogin.style.display = ok ? "none" : "";
  if (btnLogout) btnLogout.style.display = ok ? "" : "none";
  if (notifWrap) notifWrap.style.display = ok ? "" : "none";

  if (ok) {
    const isSuperAdmin = (u.uid === SUPER_ADMIN_UID);
    const saBtn = document.getElementById("btnViewSuperAdmin");
    if (saBtn) saBtn.style.display = isSuperAdmin ? "" : "none";
    
    hideLandingPage();
    
    if (isSuperAdmin) {
      const lenderSnap = await getDoc(lenderRef(u.uid));
      const hasLender = lenderSnap.exists();
      const onboardingDone = hasLender && lenderSnap.data().onboardingDone;
      
      if (hasLender && onboardingDone) {
        await loadSettings();
        document.getElementById('heroSection').style.display = "none";
        document.getElementById('clientView').style.display = "none";
        document.getElementById('adminView').className = "admin-wrap visible";
        document.getElementById('btnViewClient').style.display = "";
        document.getElementById('btnViewAdmin').style.display = "";
        if (checkSuspended() || checkPending()) { startStatusListener(); return; }
        showView("admin");
        await loadAllAdmin();
        startRealtimeListener();
        startStatusListener();
      } else {
        document.getElementById('heroSection').style.display = "none";
        document.getElementById('clientView').style.display = "none";
        document.getElementById('adminView').className = "admin-wrap";
        document.getElementById('btnViewClient').style.display = "none";
        document.getElementById('btnViewAdmin').style.display = "none";
        document.getElementById('superadminView')?.classList.add("show");
        loadSuperAdmin();
      }
    } else {
      document.getElementById('heroSection').style.display = "none";
      document.getElementById('clientView').style.display = "none";
      document.getElementById('adminView').className = "admin-wrap visible";
      document.getElementById('btnViewClient').style.display = "";
      document.getElementById('btnViewAdmin').style.display = "";
      
      await loadSettings();
      if (checkSuspended() || checkPending()) { startStatusListener(); return; }
      
      const lenderSnap = await getDoc(lenderRef(gLenderId));
      if (!lenderSnap.exists() || !lenderSnap.data().onboardingDone) {
        showOnboarding();
      } else {
        showView("admin");
        await loadAllAdmin();
        startRealtimeListener();
        startStatusListener();
      }
    }
  } else {
    document.getElementById("btnViewSuperAdmin").style.display = "none";
    if (gSnapshotUnsub) { gSnapshotUnsub(); gSnapshotUnsub = null; }
    if (!gRefLenderId) {
      showLandingPage();
    } else {
      document.getElementById('landingView')?.classList.remove("show");
      document.getElementById('btnViewClient').style.display = "";
      document.getElementById('btnViewAdmin').style.display = "";
      showView("client");
      await loadSettings();
    }
  }
});

async function doLogin() {
  const emailInput = document.getElementById('loginEmail');
  const passInput = document.getElementById('loginPass');
  const email = emailInput ? emailInput.value : prompt("Email:") || "";
  const pass = passInput ? passInput.value : prompt("Contraseña:") || "";
  if (!email || !pass) { toast("Completá email y contraseña", "err"); return; }
  try {
    await signInWithEmailAndPassword(auth, email, pass);
    toast("Sesión iniciada", "ok");
  } catch { toast("Credenciales incorrectas", "err"); }
}

document.getElementById('btnAdminLogin')?.addEventListener('click', doLogin);
document.getElementById('btnLogout')?.addEventListener('click', () => {
  if (gStatusUnsub) gStatusUnsub();
  signOut(auth).then(() => toast("Sesión cerrada", "info"));
});
document.getElementById('btnPendingLogout')?.addEventListener('click', () => {
  if (gStatusUnsub) gStatusUnsub();
  signOut(auth).then(() => {
    document.getElementById('pendingOverlay')?.classList.remove("show");
    toast("Sesión cerrada", "info");
  });
});
document.getElementById('btnResetPass')?.addEventListener('click', async () => {
  const email = prompt("Ingresá tu email:");
  if (!email) return;
  try { await sendPasswordResetEmail(auth, email); toast("Email de recuperación enviado", "ok"); }
  catch { toast("No se pudo enviar", "err"); }
});
document.getElementById('btnForgotPass')?.addEventListener('click', async (e) => {
  e.preventDefault();
  const email = document.getElementById('loginEmail')?.value;
  if (!email) { toast("Ingresá tu email primero", "err"); return; }
  try { await sendPasswordResetEmail(auth, email); toast("Email de recuperación enviado", "ok"); }
  catch { toast("No se pudo enviar", "err"); }
});
document.getElementById('btnGoToRegister')?.addEventListener('click', (e) => {
  e.preventDefault();
  window.handleSignup();
});

function startStatusListener() {
  if (!gLenderId || gStatusUnsub) return;
  gStatusUnsub = onSnapshot(lenderRef(gLenderId), (snap) => {
    if (!snap.exists()) return;
    const data = snap.data();
    const prevStatus = gSettings.status;
    const newStatus = data.status || 'activo';
    gSettings.status = newStatus;
    if (data.plazos) gSettings.plazos = data.plazos;
    if (data.brandColor) { gSettings.brandColor = data.brandColor; applyBranding(); }
    
    const pendingOverlay = document.getElementById('pendingOverlay');
    const suspendedOverlay = document.getElementById('suspendedOverlay');
    const adminContent = document.getElementById('adminContent');
    
    if (newStatus === 'pendiente') {
      pendingOverlay?.classList.add('show');
      suspendedOverlay?.classList.remove('show');
      if (adminContent) adminContent.style.display = 'none';
      if (gSnapshotUnsub) { gSnapshotUnsub(); gSnapshotUnsub = null; }
    } else if (newStatus === 'pausado') {
      suspendedOverlay?.classList.add('show');
      pendingOverlay?.classList.remove('show');
      if (adminContent) adminContent.style.display = 'none';
      if (gSnapshotUnsub) { gSnapshotUnsub(); gSnapshotUnsub = null; }
    } else if (newStatus === 'activo') {
      pendingOverlay?.classList.remove('show');
      suspendedOverlay?.classList.remove('show');
      if (gUser) {
        if (adminContent) adminContent.style.display = '';
        if (prevStatus === 'pendiente') {
          toast('🎉 ¡Tu cuenta fue activada!', 'ok', 6000);
          loadAllAdmin();
        }
        if (!gSnapshotUnsub) startRealtimeListener();
      }
    }
    refreshSimMeta();
  }, err => console.error("StatusListener error:", err));
}

function startRealtimeListener() {
  if (!gLenderId || gSnapshotUnsub) return;
  const q = query(collection(db, "loans"), where("lenderId", "==", gLenderId), where("status", "==", "pending"), orderBy("createdAt", "desc"), limit(50));
  getDocs(q).then(snap => snap.forEach(d => knownPendingIds.add(d.id)));
  gSnapshotUnsub = onSnapshot(q, snapshot => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const id = change.doc.id;
        if (!knownPendingIds.has(id)) {
          knownPendingIds.add(id);
          const data = change.doc.data();
          fireNewRequestAlert(data.borrower?.name || "Cliente", fmtMoney(data.amount), id);
        }
      }
    });
  }, err => console.error("onSnapshot error:", err));
}

function fireNewRequestAlert(name, amt, id) {
  gNotifications.unshift({ id, name, amt, time: new Date().toLocaleTimeString("es-AR"), unread: true });
  renderNotifDropdown();
  updateNotifBadge();
  
  const t = document.createElement("div");
  t.className = "toast new-req";
  t.innerHTML = `<span style="font-size:22px">🔔</span><div><div style="font-weight:800;font-size:14px">${name} solicitó ${amt}</div><div style="font-size:11px;opacity:.7;margin-top:2px">Click para ir a Pendientes →</div></div>`;
  t.onclick = () => { showView("admin"); switchTab("Pending"); t.remove(); };
  document.getElementById("toastContainer")?.appendChild(t);
  setTimeout(() => t.remove(), 9000);
  
  const alertBanner = document.getElementById("alertBanner");
  const alertBannerText = document.getElementById("alertBannerText");
  if (alertBannerText) alertBannerText.textContent = `Nueva solicitud de ${name} · ${amt}`;
  if (alertBanner) {
    alertBanner.classList.add("show");
    setTimeout(() => alertBanner.classList.remove("show"), 7000);
  }
  
  loadPend();
  computeDashboard();
}

function renderNotifDropdown() {
  const list = document.getElementById("notifList");
  if (!list) return;
  if (!gNotifications.length) { list.innerHTML = `<div class="notif-empty">Sin notificaciones nuevas</div>`; return; }
  list.innerHTML = gNotifications.slice(0, 20).map(n => `
    <div class="notif-item ${n.unread ? 'unread' : ''}" data-notif-id="${n.id}">
      <div class="notif-item-title">🔔 Nueva solicitud · ${n.name}</div>
      <div class="notif-item-sub">${n.amt} · ${n.time}</div>
    </div>`).join("");
  list.querySelectorAll(".notif-item").forEach(item => {
    item.onclick = () => { showView("admin"); switchTab("Pending"); document.getElementById("notifDropdown")?.classList.remove("open"); };
  });
}

function updateNotifBadge() {
  const count = gNotifications.filter(n => n.unread).length;
  const badge = document.getElementById("notifBadge");
  if (!badge) return;
  badge.style.display = count > 0 ? "flex" : "none";
  badge.textContent = count > 9 ? "9+" : count;
}

document.getElementById("notifBell")?.addEventListener("click", () => {
  document.getElementById("notifDropdown")?.classList.toggle("open");
  gNotifications.forEach(n => n.unread = false);
  updateNotifBadge();
  renderNotifDropdown();
});
document.getElementById("btnClearNotifs")?.addEventListener("click", () => {
  gNotifications = [];
  renderNotifDropdown();
  updateNotifBadge();
  document.getElementById("notifDropdown")?.classList.remove("open");
});
document.getElementById("alertBannerClose")?.addEventListener("click", () => {
  document.getElementById("alertBanner")?.classList.remove("show");
});
document.addEventListener("click", e => {
  const wrap = document.getElementById("notifWrap");
  const drop = document.getElementById("notifDropdown");
  if (wrap && drop && !wrap.contains(e.target)) drop.classList.remove("open");
});

function showView(v) {
  document.getElementById("landingView")?.classList.remove("show");
  document.body.classList.remove("landing-active");
  document.getElementById("superadminView")?.classList.remove("show");
  const a = v === "admin";
  const sa = v === "superadmin";
  document.getElementById("clientView").style.display = (a || sa) ? "none" : "";
  document.getElementById("heroSection").style.display = (a || sa) ? "none" : "";
  document.getElementById("adminView").className = "admin-wrap" + ((a && !sa) ? " visible" : "");
  document.getElementById("btnViewClient").className = "nav-btn" + ((!a && !sa) ? " active" : "");
  document.getElementById("btnViewAdmin").className = "nav-btn" + ((a && !sa) ? " active" : "");
  const saBtn = document.getElementById("btnViewSuperAdmin");
  if (saBtn) saBtn.className = "nav-btn" + (sa ? " active" : "");
  if (sa) document.getElementById("superadminView")?.classList.add("show");
}
document.getElementById("btnViewClient")?.addEventListener("click", () => showView("client"));
document.getElementById("btnViewAdmin")?.addEventListener("click", () => showView("admin"));
document.getElementById("btnViewSuperAdmin")?.addEventListener("click", () => { showView("superadmin"); loadSuperAdmin(); });

function switchTab(tabName) {
  document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
  document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("visible"));
  const btn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
  if (btn) btn.classList.add("active");
  const cnt = document.getElementById("tab" + tabName);
  if (cnt) cnt.classList.add("visible");
}
document.querySelectorAll(".tab-btn[data-tab]").forEach(btn => {
  btn.addEventListener("click", () => switchTab(btn.dataset.tab));
});

document.getElementById("btnSim")?.addEventListener("click", window.calculateLoan);

document.getElementById("btnSendReq")?.addEventListener("click", async () => {
  const montoSolicitado = getSimAmount();
  const months = getSimMonths();
  if (!montoSolicitado || !months) { toast("Completá el Simulador primero.", "err"); return; }
  
  const borrower = {
    name: (el("bName")?.value || "").trim(),
    dni: digits(el("bDni")?.value),
    email: (el("bEmail")?.value || "").trim(),
    phone: (el("bPhone")?.value || "").trim(),
    alias: (el("bAlias")?.value || "").trim()
  };
  if (!borrower.name || !borrower.dni) { toast("Completá nombre y DNI.", "err"); return; }

  const urlRef = new URLSearchParams(location.search).get("ref") || gRefLenderId || sessionStorage.getItem("prestify_ref");
  const lid = urlRef || gLenderId;
  if (!lid) { toast("Error: no se detectó el prestamista.", "err"); return; }
  if (!gSettings.tna) { toast("Error: no se pudo cargar la configuración.", "err"); return; }

  const result = calculateFrenchLoan(montoSolicitado, months, gSettings.tna);

  try {
    await addDoc(collection(db, "loans"), {
      status: "pending", lenderId: lid, amount: montoSolicitado,
      gastoOtorgPct: GASTO_OTORGAMIENTO, gastoOtorgAmt: result.gastoOtorgAmt,
      capitalFinanciar: result.capitalFinanciar, months, tna: gSettings.tna || 0,
      dueDay: gSettings.dueDay || 10, installment: result.cuota, borrower,
      createdAt: nowTS(), updatedAt: nowTS()
    });
    
    const sendBtn = document.getElementById("btnSendReq");
    sendBtn.innerHTML = `<svg viewBox="0 0 24 24" style="width:20px;height:20px;stroke:#fff;fill:none;stroke-width:2.5"><polyline points="20 6 9 17 4 12"/></svg> ¡Enviada!`;
    sendBtn.disabled = true;
    ["bName","bDni","bEmail","bPhone","bAlias"].forEach(id => { const e = document.getElementById(id); if (e) e.value = ""; });
    toast("✅ Solicitud enviada. Te contactaremos pronto.", "ok", 5000);
    setTimeout(() => { sendBtn.innerHTML = "Enviar solicitud"; sendBtn.disabled = false; }, 6000);
  } catch (e) { toast("Error al enviar.", "err"); console.error(e); }
});

async function loadSuperAdmin() {
  const listEl = document.getElementById("saLendersList");
  if (!listEl) return;
  listEl.innerHTML = `<div class="sa-loading"><div class="spinner"></div><p>Cargando prestamistas...</p></div>`;
  
  try {
    const lendersSnap = await getDocs(collection(db, "lenders"));
    const lenders = []; lendersSnap.forEach(d => lenders.push({ id: d.id, ...d.data() }));
    const loansSnap = await getDocs(collection(db, "loans"));
    const loans = []; loansSnap.forEach(d => loans.push({ id: d.id, ...d.data() }));
    
    document.getElementById("saCountLenders").textContent = lenders.length;
    document.getElementById("saCountActive").textContent = lenders.filter(l => l.status === "activo").length;
    document.getElementById("saCountPending").textContent = lenders.filter(l => l.status === "pendiente").length;
    document.getElementById("saCountLoans").textContent = loans.length;
    
    const loansByLender = {};
    loans.forEach(loan => {
      const lid = loan.lenderId;
      if (!loansByLender[lid]) loansByLender[lid] = { total: 0, active: 0, paid: 0, amount: 0 };
      loansByLender[lid].total++;
      loansByLender[lid].amount += (loan.amount || 0);
      if (loan.status === "active") loansByLender[lid].active++;
      if (loan.status === "paid") loansByLender[lid].paid++;
    });
    
    let totalAmountEl = document.getElementById("saTotalAmount");
    if (!totalAmountEl) {
      const newMetric = document.createElement("div");
      newMetric.className = "sa-metric-card";
      newMetric.innerHTML = `<div class="sa-metric-label">Total prestado</div><div class="sa-metric-val" id="saTotalAmount">${fmtMoney(loans.reduce((s,l)=>s+(l.amount||0),0))}</div>`;
      document.getElementById("saMetrics")?.appendChild(newMetric);
    } else {
      totalAmountEl.textContent = fmtMoney(loans.reduce((s,l)=>s+(l.amount||0),0));
    }
    
    if (!lenders.length) { listEl.innerHTML = `<div class="empty">No hay prestamistas registrados</div>`; return; }
    
    lenders.sort((a,b)=> (({pendiente:0,activo:1,pausado:2})[a.status]??1) - (({pendiente:0,activo:1,pausado:2})[b.status]??1));
    
    listEl.innerHTML = lenders.map(l => {
      const status = l.status || "activo";
      const pillClass = status === "activo" ? "activo" : status === "pendiente" ? "pendiente" : "pausado";
      const pillLabel = status === "activo" ? "✓ Activo" : status === "pendiente" ? "⏳ Pendiente" : "⛔ Pausado";
      const loans = loansByLender[l.id] || { total: 0, active: 0, paid: 0, amount: 0 };
      return `<div class="sa-row" id="sarow-${l.id}">
        <div>
          <div class="sa-lender-name">${l.appName || "Sin nombre"}</div>
          <div class="sa-lender-email">${l.operator?.name || ""} ${l.operator?.email ? "· " + l.operator.email : ""}</div>
          <div class="sa-lender-id">${l.id}</div>
          <div style="font-size:11px;color:var(--muted);margin-top:5px;">📊 Préstamos: ${loans.total} (${loans.active} activos)<br>💰 $${Math.round(loans.amount).toLocaleString('es-AR')}</div>
        </div>
        <div>${l.operator?.email || "—"}${l.wa ? `<div style="font-size:10px;color:#25d366;">WA: ${l.wa}</div>` : ""}</div>
        <div><span class="sa-status-pill ${pillClass}">${pillLabel}</span></div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          ${status !== "activo" ? `<button class="sa-action-btn sa-btn-activate" onclick="saSetStatus('${l.id}','activo')">✓ Activar</button>` : ""}
          ${status === "activo" ? `<button class="sa-action-btn sa-btn-suspend" onclick="saSetStatus('${l.id}','pausado')">⛔ Suspender</button>` : ""}
          <button class="sa-action-btn sa-btn-outline" onclick="saViewDetails('${l.id}')">👁 Detalles</button>
        </div>
      </div>`;
    }).join("");
  } catch (e) { listEl.innerHTML = `<div class="empty" style="color:#f87171">Error: ${e.message}</div>`; }
}

window.saSetStatus = async (lenderId, newStatus) => {
  try {
    await setDoc(doc(db, "lenders", lenderId), { status: newStatus, updatedAt: nowTS() }, { merge: true });
    await setDoc(doc(db, "settings", lenderId), { status: newStatus, updatedAt: nowTS() }, { merge: true });
    toast(`Prestamista ${newStatus === "activo" ? "activado" : "suspendido"}`, newStatus === "activo" ? "ok" : "err");
    await loadSuperAdmin();
  } catch (e) { toast("Error: " + e.message, "err"); }
};

window.saViewDetails = async (lenderId) => {
  try {
    const lender = (await getDoc(doc(db, "lenders", lenderId))).data();
    const settings = (await getDoc(doc(db, "settings", lenderId))).data() || {};
    const loans = (await getDocs(query(collection(db, "loans"), where("lenderId", "==", lenderId)))).docs.map(d=>d.data());
    alert(`
🏢 ${lender.appName || "Sin nombre"}
📍 ${lender.city || "—"}
👤 Operador: ${lender.operator?.name || "—"} (${lender.operator?.email || "—"})
📊 TNA: ${lender.tna || settings.tna || "—"}%
📅 Vencimiento: día ${lender.dueDay || settings.dueDay || "—"}
💰 Gastos admin: ${lender.expenses || settings.expenses || 0}%

📋 PRÉSTAMOS:
• Total: ${loans.length}
• Activos: ${loans.filter(l=>l.status==="active").length}
• Pagados: ${loans.filter(l=>l.status==="paid").length}
• Monto total: ${fmtMoney(loans.reduce((s,l)=>s+(l.amount||0),0))}
    `);
  } catch (e) { toast("Error: " + e.message, "err"); }
};

document.getElementById("btnSaLogout")?.addEventListener("click", () => {
  if (gStatusUnsub) gStatusUnsub();
  signOut(auth).then(() => {
    document.getElementById("superadminView")?.classList.remove("show");
    showLandingPage();
    toast("Sesión cerrada", "info");
  });
});

async function loadPend() {}
async function loadPre() {}
async function loadAct() {}
async function loadMora() {}
async function loadComprobantes() {}
async function loadInact() {}
async function loadAllAdmin() {}
async function computeDashboard() {}

console.log('✅ Módulo script.js cargado completamente');
</script>
<script>
// TEST: Ver qué pasa cuando hacés click
document.getElementById('btnLandingRegister').onclick = function(e) {
  e.preventDefault();
  e.stopPropagation();
  
  console.log('1. Click detectado');
  console.log('2. gLenderId =', gLenderId);
  console.log('3. gUser =', gUser ? gUser.uid : 'null');
  console.log('4. auth.currentUser =', auth?.currentUser?.uid || 'null');
  
  if (typeof showOnboarding === 'function') {
    console.log('5. showOnboarding existe');
    showOnboarding();
  } else {
    console.log('5. showOnboarding NO existe');
    alert('showOnboarding no está definida');
  }
  
  return false;
};
</script>

</body>
</html>